<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹„ë“œë°”ì´ ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --toss-black: #191F28;
            --toss-gray-900: #333D4B;
            --toss-gray-700: #4E5968;
            --toss-gray-600: #6B7684;
            --toss-gray-500: #8B95A1;
            --toss-gray-400: #B0B8C1;
            --toss-gray-300: #D1D6DB;
            --toss-gray-200: #E5E8EB;
            --toss-gray-100: #F2F4F6;
            --toss-gray-50: #F9FAFB;
            --toss-white: #FFFFFF;
            --toss-blue: #3182F6;
            --toss-blue-light: #E8F3FF;
            --toss-red: #F04452;
            --toss-red-light: #FFEBEE;
            --toss-green: #30B06E;
            --toss-green-light: #E8F5E9;
            --toss-yellow: #F59F00;
            --toss-yellow-light: #FFF9E6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Pretendard', 'Segoe UI', sans-serif;
            background: var(--toss-gray-50);
            color: var(--toss-black);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* í† ìŠ¤ ìŠ¤íƒ€ì¼ ë„¤ë¹„ê²Œì´ì…˜ */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: var(--toss-white);
            border-bottom: 1px solid var(--toss-gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 100;
        }

        .nav-logo {
            font-size: 18px;
            font-weight: 700;
            color: var(--toss-black);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-logo span {
            color: var(--toss-blue);
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .nav-user-name {
            font-size: 14px;
            color: var(--toss-gray-700);
        }

        .btn-logout {
            font-size: 14px;
            color: var(--toss-gray-600);
            background: none;
            border: none;
            cursor: pointer;
            transition: color 0.2s;
        }

        .btn-logout:hover {
            color: var(--toss-red);
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            position: fixed;
            top: 56px;
            left: 0;
            bottom: 0;
            width: 240px;
            background: var(--toss-white);
            border-right: 1px solid var(--toss-gray-200);
            padding: 24px 0;
            overflow-y: auto;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-item {
            margin-bottom: 4px;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            font-size: 15px;
            color: var(--toss-gray-700);
            text-decoration: none;
            transition: all 0.15s;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .sidebar-link:hover {
            background: var(--toss-gray-100);
            color: var(--toss-black);
        }

        .sidebar-link.active {
            background: var(--toss-blue-light);
            color: var(--toss-blue);
            font-weight: 600;
        }

        .sidebar-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main {
            margin-left: 240px;
            margin-top: 56px;
            min-height: calc(100vh - 56px);
            padding: 32px;
        }

        /* í˜ì´ì§€ í—¤ë” */
        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 26px;
            font-weight: 700;
            color: var(--toss-black);
            margin-bottom: 8px;
        }

        .page-desc {
            font-size: 15px;
            color: var(--toss-gray-600);
        }

        /* ì¹´ë“œ */
        .card {
            background: var(--toss-white);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--toss-black);
        }

        /* í†µê³„ ì¹´ë“œ ê·¸ë¦¬ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--toss-white);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }

        .stat-label {
            font-size: 14px;
            color: var(--toss-gray-600);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--toss-black);
        }

        .stat-change {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .stat-change.up {
            color: var(--toss-red);
            background: var(--toss-red-light);
        }

        .stat-change.down {
            color: var(--toss-green);
            background: var(--toss-green-light);
        }

        /* ë²„íŠ¼ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            font-size: 15px;
            font-weight: 600;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn-primary {
            background: var(--toss-blue);
            color: var(--toss-white);
        }

        .btn-primary:hover {
            background: #2272E6;
        }

        .btn-secondary {
            background: var(--toss-gray-100);
            color: var(--toss-gray-700);
        }

        .btn-secondary:hover {
            background: var(--toss-gray-200);
        }

        .btn-ghost {
            background: transparent;
            color: var(--toss-gray-600);
        }

        .btn-ghost:hover {
            background: var(--toss-gray-100);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 8px;
        }

        /* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ */
        .upload-zone {
            border: 2px dashed var(--toss-gray-300);
            border-radius: 16px;
            padding: 48px;
            text-align: center;
            transition: all 0.2s;
            cursor: pointer;
        }

        .upload-zone:hover,
        .upload-zone.dragover {
            border-color: var(--toss-blue);
            background: var(--toss-blue-light);
        }

        .upload-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            background: var(--toss-gray-100);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .upload-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--toss-black);
            margin-bottom: 8px;
        }

        .upload-desc {
            font-size: 14px;
            color: var(--toss-gray-600);
        }

        /* í…Œì´ë¸” */
        .table-wrapper {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            text-align: left;
            padding: 12px 16px;
            font-size: 13px;
            font-weight: 600;
            color: var(--toss-gray-600);
            background: var(--toss-gray-50);
            border-bottom: 1px solid var(--toss-gray-200);
        }

        .table td {
            padding: 16px;
            font-size: 14px;
            color: var(--toss-gray-900);
            border-bottom: 1px solid var(--toss-gray-100);
        }

        .table tr:hover td {
            background: var(--toss-gray-50);
        }

        /* ë±ƒì§€ */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            font-size: 12px;
            font-weight: 600;
            border-radius: 6px;
        }

        .badge-blue {
            background: var(--toss-blue-light);
            color: var(--toss-blue);
        }

        .badge-green {
            background: var(--toss-green-light);
            color: var(--toss-green);
        }

        .badge-red {
            background: var(--toss-red-light);
            color: var(--toss-red);
        }

        .badge-yellow {
            background: var(--toss-yellow-light);
            color: var(--toss-yellow);
        }

        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
        .chart-container {
            position: relative;
            height: 300px;
        }

        /* ì…ë ¥ í¼ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--toss-gray-700);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            font-size: 15px;
            border: 1px solid var(--toss-gray-300);
            border-radius: 12px;
            transition: all 0.15s;
            outline: none;
        }

        .form-input:focus {
            border-color: var(--toss-blue);
            box-shadow: 0 0 0 3px var(--toss-blue-light);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236B7684' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
        }

        /* ë‰´ìŠ¤ë ˆí„° ì—ë””í„° */
        .editor-toolbar {
            display: flex;
            gap: 8px;
            padding: 12px;
            background: var(--toss-gray-50);
            border-radius: 12px 12px 0 0;
            border: 1px solid var(--toss-gray-200);
            border-bottom: none;
        }

        .editor-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--toss-white);
            border: 1px solid var(--toss-gray-200);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .editor-btn:hover {
            background: var(--toss-gray-100);
        }

        .editor-content {
            min-height: 300px;
            padding: 20px;
            border: 1px solid var(--toss-gray-200);
            border-radius: 0 0 12px 12px;
            outline: none;
            font-size: 15px;
            line-height: 1.8;
        }

        /* ë‰´ìŠ¤ë ˆí„° ë¯¸ë¦¬ë³´ê¸° */
        .newsletter-preview {
            background: var(--toss-white);
            border: 1px solid var(--toss-gray-200);
            border-radius: 12px;
            overflow: hidden;
        }

        .newsletter-header {
            background: linear-gradient(135deg, var(--toss-blue), #1E6BD6);
            color: var(--toss-white);
            padding: 32px;
            text-align: center;
        }

        .newsletter-body {
            padding: 32px;
        }

        /* ì¹´í…Œê³ ë¦¬ ì¹© */
        .category-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .chip {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            background: var(--toss-gray-100);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .chip:hover {
            background: var(--toss-gray-200);
        }

        .chip.active {
            background: var(--toss-blue);
            color: var(--toss-white);
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--toss-gray-200);
            border-top-color: var(--toss-blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 32px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--toss-gray-900);
            color: var(--toss-white);
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* ëª¨ë‹¬ */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }

        .modal-backdrop.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--toss-white);
            border-radius: 20px;
            width: 100%;
            max-width: 480px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95);
            transition: all 0.2s;
        }

        .modal-backdrop.show .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 24px 24px 0;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 0 24px 24px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* ë¡œê·¸ì¸ */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f8fafc 0%, #e8f3ff 100%);
        }

        .login-card {
            background: var(--toss-white);
            border-radius: 24px;
            padding: 48px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-logo h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .login-logo span {
            color: var(--toss-blue);
        }

        .login-logo p {
            color: var(--toss-gray-600);
            font-size: 14px;
            margin-top: 8px;
        }

        /* ê·¸ë¦¬ë“œ */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        /* íƒ­ */
        .tabs {
            display: flex;
            gap: 4px;
            padding: 4px;
            background: var(--toss-gray-100);
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .tab {
            flex: 1;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            color: var(--toss-gray-600);
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .tab:hover {
            color: var(--toss-gray-900);
        }

        .tab.active {
            background: var(--toss-white);
            color: var(--toss-black);
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--toss-black);
            margin-bottom: 8px;
        }

        .empty-desc {
            font-size: 14px;
            color: var(--toss-gray-600);
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .main {
                margin-left: 0;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <div id="toast" class="toast"></div>

    <script>
        // ============================================
        // ìƒíƒœ ê´€ë¦¬
        // ============================================
        const state = {
            isLoggedIn: localStorage.getItem('isLoggedIn') === 'true',
            currentPage: 'dashboard',
            salesData: JSON.parse(localStorage.getItem('salesData')) || [],
            categoryStats: {},
            trendData: JSON.parse(localStorage.getItem('trendData')) || [],
            newsletters: JSON.parse(localStorage.getItem('newsletters')) || [],
            subscribers: JSON.parse(localStorage.getItem('subscribers')) || [
                { id: 1, email: 'user1@example.com', name: 'ê¹€ì² ìˆ˜', subscribed: true, createdAt: '2024-11-01' },
                { id: 2, email: 'user2@example.com', name: 'ì´ì˜í¬', subscribed: true, createdAt: '2024-11-05' },
            ],
            selectedCategory: 'all',
            geminiApiKey: localStorage.getItem('gemini_api_key') || '',
            isGenerating: false,
            showApiKey: false,
            weekInfo: { month: new Date().getMonth() + 1, week: Math.ceil(new Date().getDate() / 7) }
        };

        // ============================================
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        // ============================================
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(num);
        }

        function formatCurrency(num) {
            return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(num);
        }

        function saveState() {
            localStorage.setItem('salesData', JSON.stringify(state.salesData));
            localStorage.setItem('trendData', JSON.stringify(state.trendData));
            localStorage.setItem('newsletters', JSON.stringify(state.newsletters));
            localStorage.setItem('subscribers', JSON.stringify(state.subscribers));
        }

        // ============================================
        // ì—‘ì…€ íŒŒì‹±
        // ============================================
        function parseExcel(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                        resolve(jsonData);
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        // ============================================
        // ì¹´í…Œê³ ë¦¬ë³„ ë¶„ì„
        // ============================================
        function analyzeSalesData() {
            const stats = {};
            let totalSales = 0;
            let totalQuantity = 0;

            state.salesData.forEach(item => {
                const category = item['ì¹´í…Œê³ ë¦¬'] || item.category || item.Category || 'ê¸°íƒ€';
                const sales = parseFloat(item['íŒë§¤ê¸ˆì•¡'] || item.sales || item.Sales || item['ê¸ˆì•¡'] || 0);
                const quantity = parseInt(item['íŒë§¤ìˆ˜ëŸ‰'] || item.quantity || item.Quantity || item['ìˆ˜ëŸ‰'] || 1);

                if (!stats[category]) {
                    stats[category] = { sales: 0, quantity: 0, items: [] };
                }

                stats[category].sales += sales;
                stats[category].quantity += quantity;
                stats[category].items.push(item);
                totalSales += sales;
                totalQuantity += quantity;
            });

            // ë¹„ìœ¨ ê³„ì‚°
            Object.keys(stats).forEach(cat => {
                stats[cat].salesRatio = totalSales > 0 ? (stats[cat].sales / totalSales * 100).toFixed(1) : 0;
                stats[cat].quantityRatio = totalQuantity > 0 ? (stats[cat].quantity / totalQuantity * 100).toFixed(1) : 0;
            });

            state.categoryStats = stats;
            state.totalSales = totalSales;
            state.totalQuantity = totalQuantity;
        }

        // ============================================
        // Gemini API
        // ============================================
        async function generateWithGemini(prompt) {
            if (!state.geminiApiKey) {
                showToast('API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”');
                return null;
            }

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${state.geminiApiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { temperature: 0.8, maxOutputTokens: 2048 }
                })
            });

            const data = await response.json();
            if (data.candidates?.[0]) {
                return data.candidates[0].content.parts[0].text;
            }
            throw new Error(data.error?.message || 'API ì˜¤ë¥˜');
        }

        // ============================================
        // ë Œë”ë§
        // ============================================
        function render() {
            const app = document.getElementById('app');
            app.innerHTML = state.isLoggedIn ? renderApp() : renderLogin();
            attachEvents();

            if (state.isLoggedIn && state.currentPage === 'dashboard') {
                setTimeout(renderCharts, 100);
            }
            if (state.isLoggedIn && state.currentPage === 'analysis') {
                setTimeout(renderAnalysisCharts, 100);
            }
        }

        function renderLogin() {
            return `
            <div class="login-container">
                <div class="login-card">
                    <div class="login-logo">
                        <h1>ë¹„ë“œë°”ì´<span>ì½”ë¦¬ì•„</span></h1>
                        <p>íŒë§¤ ë¶„ì„ & ë‰´ìŠ¤ë ˆí„° ì‹œìŠ¤í…œ</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì•„ì´ë””</label>
                        <input type="text" id="loginId" class="form-input" placeholder="admin">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="loginPw" class="form-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <button id="loginBtn" class="btn btn-primary" style="width:100%;margin-top:8px;">ë¡œê·¸ì¸</button>
                    <p style="text-align:center;margin-top:16px;font-size:13px;color:var(--toss-gray-500);">ID: admin / PW: admin123</p>
                </div>
            </div>`;
        }

        function renderApp() {
            return `
            <nav class="nav">
                <div class="nav-logo">ë¹„ë“œë°”ì´<span>ì• ë„ë¦¬í‹±ìŠ¤</span></div>
                <div class="nav-user">
                    <span class="nav-user-name">ê´€ë¦¬ìë‹˜</span>
                    <button class="btn-logout" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </nav>

            <aside class="sidebar">
                <ul class="sidebar-menu">
                    <li class="sidebar-item">
                        <button class="sidebar-link ${state.currentPage === 'dashboard' ? 'active' : ''}" data-page="dashboard">
                            <span class="sidebar-icon">ğŸ“Š</span>
                            ëŒ€ì‹œë³´ë“œ
                        </button>
                    </li>
                    <li class="sidebar-item">
                        <button class="sidebar-link ${state.currentPage === 'upload' ? 'active' : ''}" data-page="upload">
                            <span class="sidebar-icon">ğŸ“¤</span>
                            ë°ì´í„° ì—…ë¡œë“œ
                        </button>
                    </li>
                    <li class="sidebar-item">
                        <button class="sidebar-link ${state.currentPage === 'analysis' ? 'active' : ''}" data-page="analysis">
                            <span class="sidebar-icon">ğŸ“ˆ</span>
                            íŒë§¤ ë¶„ì„
                        </button>
                    </li>
                    <li class="sidebar-item">
                        <button class="sidebar-link ${state.currentPage === 'trends' ? 'active' : ''}" data-page="trends">
                            <span class="sidebar-icon">ğŸ”¥</span>
                            íŠ¸ë Œë“œ ê´€ë¦¬
                        </button>
                    </li>
                    <li class="sidebar-item">
                        <button class="sidebar-link ${state.currentPage === 'newsletter' ? 'active' : ''}" data-page="newsletter">
                            <span class="sidebar-icon">âœ‰ï¸</span>
                            ë‰´ìŠ¤ë ˆí„°
                        </button>
                    </li>
                    <li class="sidebar-item">
                        <button class="sidebar-link ${state.currentPage === 'subscribers' ? 'active' : ''}" data-page="subscribers">
                            <span class="sidebar-icon">ğŸ‘¥</span>
                            êµ¬ë…ì ê´€ë¦¬
                        </button>
                    </li>
                    <li class="sidebar-item">
                        <button class="sidebar-link ${state.currentPage === 'settings' ? 'active' : ''}" data-page="settings">
                            <span class="sidebar-icon">âš™ï¸</span>
                            ì„¤ì •
                        </button>
                    </li>
                </ul>
            </aside>

            <main class="main">
                ${renderPage()}
            </main>`;
        }

        function renderPage() {
            switch(state.currentPage) {
                case 'dashboard': return renderDashboard();
                case 'upload': return renderUpload();
                case 'analysis': return renderAnalysis();
                case 'trends': return renderTrends();
                case 'newsletter': return renderNewsletter();
                case 'subscribers': return renderSubscribers();
                case 'settings': return renderSettings();
                default: return renderDashboard();
            }
        }

        function renderDashboard() {
            analyzeSalesData();
            const categories = Object.keys(state.categoryStats);
            const topCategory = categories.sort((a, b) => state.categoryStats[b].sales - state.categoryStats[a].sales)[0];

            return `
            <div class="page-header">
                <h1 class="page-title">ëŒ€ì‹œë³´ë“œ</h1>
                <p class="page-desc">${state.weekInfo.month}ì›” ${state.weekInfo.week}ì£¼ì°¨ í˜„í™©</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ì´ íŒë§¤ê¸ˆì•¡</div>
                    <div class="stat-value">${formatCurrency(state.totalSales || 0)}</div>
                    <span class="stat-change up">â†‘ 12.5%</span>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì´ íŒë§¤ìˆ˜ëŸ‰</div>
                    <div class="stat-value">${formatNumber(state.totalQuantity || 0)}ê°œ</div>
                    <span class="stat-change up">â†‘ 8.3%</span>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ë“±ë¡ ì¹´í…Œê³ ë¦¬</div>
                    <div class="stat-value">${categories.length}ê°œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">êµ¬ë…ì ìˆ˜</div>
                    <div class="stat-value">${state.subscribers.filter(s => s.subscribed).length}ëª…</div>
                    <span class="stat-change up">â†‘ 5ëª…</span>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ ë¹„ì¤‘</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ì£¼ê°„ íŒë§¤ ì¶”ì´</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="weeklyChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">TOP 5 ì¸ê¸° í‚¤ì›Œë“œ</h3>
                    <button class="btn btn-secondary btn-sm" data-page="trends">ì „ì²´ë³´ê¸°</button>
                </div>
                ${state.trendData.length > 0 ? `
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ìˆœìœ„</th>
                                <th>í‚¤ì›Œë“œ</th>
                                <th>ì¹´í…Œê³ ë¦¬</th>
                                <th>ê²€ìƒ‰ëŸ‰</th>
                                <th>ë³€í™”</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.trendData.slice(0, 5).map((item, i) => `
                            <tr>
                                <td><span class="badge ${i < 3 ? 'badge-red' : 'badge-blue'}">${i + 1}</span></td>
                                <td style="font-weight:600;">${item.keyword}</td>
                                <td>${item.category}</td>
                                <td>${formatNumber(item.searches)}ê±´</td>
                                <td><span class="${item.change >= 0 ? 'badge badge-red' : 'badge badge-green'}">${item.change >= 0 ? 'â†‘' : 'â†“'}${Math.abs(item.change)}%</span></td>
                            </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : `
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“Š</div>
                    <div class="empty-title">íŠ¸ë Œë“œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                    <div class="empty-desc">íŠ¸ë Œë“œ ê´€ë¦¬ì—ì„œ ë°ì´í„°ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>
                </div>
                `}
            </div>`;
        }

        function renderUpload() {
            return `
            <div class="page-header">
                <h1 class="page-title">ë°ì´í„° ì—…ë¡œë“œ</h1>
                <p class="page-desc">ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ íŒë§¤ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì„¸ìš”</p>
            </div>

            <div class="card">
                <div class="upload-zone" id="uploadZone">
                    <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" style="display:none;">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-title">ì—‘ì…€ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</div>
                    <div class="upload-desc">ì§€ì› í˜•ì‹: .xlsx, .xls, .csv</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ë°ì´í„° í˜•ì‹ ì•ˆë‚´</h3>
                </div>
                <p style="color:var(--toss-gray-600);font-size:14px;margin-bottom:16px;">
                    ì—‘ì…€ íŒŒì¼ì— ë‹¤ìŒ ì—´ì´ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:
                </p>
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ì—´ ì´ë¦„ (ì˜ˆì‹œ)</th>
                                <th>ì„¤ëª…</th>
                                <th>í•„ìˆ˜ ì—¬ë¶€</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>ì¹´í…Œê³ ë¦¬</code> ë˜ëŠ” <code>category</code></td>
                                <td>ìƒí’ˆ ì¹´í…Œê³ ë¦¬</td>
                                <td><span class="badge badge-red">í•„ìˆ˜</span></td>
                            </tr>
                            <tr>
                                <td><code>íŒë§¤ê¸ˆì•¡</code> ë˜ëŠ” <code>sales</code></td>
                                <td>íŒë§¤ ê¸ˆì•¡</td>
                                <td><span class="badge badge-red">í•„ìˆ˜</span></td>
                            </tr>
                            <tr>
                                <td><code>íŒë§¤ìˆ˜ëŸ‰</code> ë˜ëŠ” <code>quantity</code></td>
                                <td>íŒë§¤ ìˆ˜ëŸ‰</td>
                                <td><span class="badge badge-blue">ì„ íƒ</span></td>
                            </tr>
                            <tr>
                                <td><code>ìƒí’ˆëª…</code> ë˜ëŠ” <code>product</code></td>
                                <td>ìƒí’ˆ ì´ë¦„</td>
                                <td><span class="badge badge-blue">ì„ íƒ</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            ${state.salesData.length > 0 ? `
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ì—…ë¡œë“œëœ ë°ì´í„° (${state.salesData.length}ê±´)</h3>
                    <button class="btn btn-secondary btn-sm" id="clearDataBtn">ë°ì´í„° ì´ˆê¸°í™”</button>
                </div>
                <div class="table-wrapper" style="max-height:400px;overflow-y:auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                ${Object.keys(state.salesData[0]).map(key => `<th>${key}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${state.salesData.slice(0, 50).map(row => `
                            <tr>
                                ${Object.values(row).map(val => `<td>${val}</td>`).join('')}
                            </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ${state.salesData.length > 50 ? `<p style="text-align:center;color:var(--toss-gray-500);padding:16px;">... ì™¸ ${state.salesData.length - 50}ê±´</p>` : ''}
            </div>
            ` : ''}`;
        }

        function renderAnalysis() {
            analyzeSalesData();
            const categories = Object.keys(state.categoryStats);
            const sortedCategories = categories.sort((a, b) => state.categoryStats[b].sales - state.categoryStats[a].sales);

            return `
            <div class="page-header">
                <h1 class="page-title">íŒë§¤ ë¶„ì„</h1>
                <p class="page-desc">ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ í˜„í™©ì„ ë¶„ì„í•©ë‹ˆë‹¤</p>
            </div>

            ${state.salesData.length === 0 ? `
            <div class="card">
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“Š</div>
                    <div class="empty-title">ë¶„ì„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                    <div class="empty-desc">ë°ì´í„° ì—…ë¡œë“œ í˜ì´ì§€ì—ì„œ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</div>
                    <button class="btn btn-primary" style="margin-top:20px;" data-page="upload">ë°ì´í„° ì—…ë¡œë“œí•˜ê¸°</button>
                </div>
            </div>
            ` : `
            <div class="category-chips">
                <button class="chip ${state.selectedCategory === 'all' ? 'active' : ''}" data-category="all">ì „ì²´</button>
                ${sortedCategories.map(cat => `
                    <button class="chip ${state.selectedCategory === cat ? 'active' : ''}" data-category="${cat}">${cat}</button>
                `).join('')}
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ì´ íŒë§¤ê¸ˆì•¡</div>
                    <div class="stat-value">${formatCurrency(state.totalSales)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì´ íŒë§¤ìˆ˜ëŸ‰</div>
                    <div class="stat-value">${formatNumber(state.totalQuantity)}ê°œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">í‰ê·  ê°ë‹¨ê°€</div>
                    <div class="stat-value">${formatCurrency(state.totalQuantity > 0 ? state.totalSales / state.totalQuantity : 0)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì¹´í…Œê³ ë¦¬ ìˆ˜</div>
                    <div class="stat-value">${categories.length}ê°œ</div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ê¸ˆì•¡</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="salesPieChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ìˆ˜ëŸ‰</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="quantityBarChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ì¹´í…Œê³ ë¦¬ë³„ ìƒì„¸ í˜„í™©</h3>
                    <button class="btn btn-secondary btn-sm" id="exportAnalysisBtn">ğŸ“¥ ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ</button>
                </div>
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ìˆœìœ„</th>
                                <th>ì¹´í…Œê³ ë¦¬</th>
                                <th>íŒë§¤ê¸ˆì•¡</th>
                                <th>ë¹„ì¤‘</th>
                                <th>íŒë§¤ìˆ˜ëŸ‰</th>
                                <th>í‰ê· ë‹¨ê°€</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${sortedCategories.map((cat, i) => {
                                const data = state.categoryStats[cat];
                                return `
                                <tr>
                                    <td><span class="badge ${i < 3 ? 'badge-red' : 'badge-blue'}">${i + 1}</span></td>
                                    <td style="font-weight:600;">${cat}</td>
                                    <td>${formatCurrency(data.sales)}</td>
                                    <td>
                                        <div style="display:flex;align-items:center;gap:8px;">
                                            <div style="flex:1;height:8px;background:var(--toss-gray-100);border-radius:4px;overflow:hidden;">
                                                <div style="width:${data.salesRatio}%;height:100%;background:var(--toss-blue);border-radius:4px;"></div>
                                            </div>
                                            <span style="font-size:13px;color:var(--toss-gray-600);min-width:45px;">${data.salesRatio}%</span>
                                        </div>
                                    </td>
                                    <td>${formatNumber(data.quantity)}ê°œ</td>
                                    <td>${formatCurrency(data.quantity > 0 ? data.sales / data.quantity : 0)}</td>
                                </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
            `}`;
        }

        function renderTrends() {
            return `
            <div class="page-header">
                <h1 class="page-title">íŠ¸ë Œë“œ ê´€ë¦¬</h1>
                <p class="page-desc">ì¸ê¸° ê²€ìƒ‰ í‚¤ì›Œë“œë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">íŠ¸ë Œë“œ í‚¤ì›Œë“œ</h3>
                    <div style="display:flex;gap:8px;">
                        <button class="btn btn-secondary btn-sm" id="importTrendBtn">ğŸ“¤ ê°€ì ¸ì˜¤ê¸°</button>
                        <button class="btn btn-primary btn-sm" id="addTrendBtn">+ ì¶”ê°€</button>
                    </div>
                </div>

                ${state.trendData.length > 0 ? `
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ìˆœìœ„</th>
                                <th>í‚¤ì›Œë“œ</th>
                                <th>ì¹´í…Œê³ ë¦¬</th>
                                <th>ê²€ìƒ‰ëŸ‰</th>
                                <th>ë³€í™”ìœ¨</th>
                                <th>ê°€ê²©(ì—”)</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.trendData.map((item, i) => `
                            <tr>
                                <td><span class="badge ${i < 3 ? 'badge-red' : 'badge-blue'}">${i + 1}</span></td>
                                <td style="font-weight:600;">${item.keyword}</td>
                                <td>${item.category}</td>
                                <td>${formatNumber(item.searches)}ê±´</td>
                                <td><span class="${item.change >= 0 ? 'badge badge-red' : 'badge badge-green'}">${item.change >= 0 ? 'â†‘' : 'â†“'}${Math.abs(item.change)}%</span></td>
                                <td>${formatNumber(item.price || 0)}ì—”</td>
                                <td>
                                    <button class="btn btn-ghost btn-sm edit-trend-btn" data-id="${item.id}">ìˆ˜ì •</button>
                                    <button class="btn btn-ghost btn-sm delete-trend-btn" data-id="${item.id}" style="color:var(--toss-red);">ì‚­ì œ</button>
                                </td>
                            </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : `
                <div class="empty-state">
                    <div class="empty-icon">ğŸ”¥</div>
                    <div class="empty-title">íŠ¸ë Œë“œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                    <div class="empty-desc">ìƒˆë¡œìš´ íŠ¸ë Œë“œ í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>
                </div>
                `}
            </div>`;
        }

        function renderNewsletter() {
            return `
            <div class="page-header">
                <h1 class="page-title">ë‰´ìŠ¤ë ˆí„°</h1>
                <p class="page-desc">êµ¬ë…ìì—ê²Œ ë°œì†¡í•  ë‰´ìŠ¤ë ˆí„°ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤</p>
            </div>

            <div class="tabs">
                <button class="tab active" data-tab="write">ì‘ì„±í•˜ê¸°</button>
                <button class="tab" data-tab="ai">AI ìƒì„±</button>
                <button class="tab" data-tab="history">ë°œì†¡ ë‚´ì—­</button>
            </div>

            <div id="newsletterContent">
                ${renderNewsletterWrite()}
            </div>`;
        }

        function renderNewsletterWrite() {
            return `
            <div class="grid-2">
                <div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ë‰´ìŠ¤ë ˆí„° ì‘ì„±</h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ì œëª©</label>
                            <input type="text" id="newsletterTitle" class="form-input" placeholder="ì´ë²ˆ ì£¼ ë¹„ë“œë°”ì´ íŠ¸ë Œë“œ">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ë³¸ë¬¸</label>
                            <div class="editor-toolbar">
                                <button class="editor-btn" title="êµµê²Œ"><b>B</b></button>
                                <button class="editor-btn" title="ê¸°ìš¸ì„"><i>I</i></button>
                                <button class="editor-btn" title="ë§í¬">ğŸ”—</button>
                                <button class="editor-btn" title="ì´ë¯¸ì§€">ğŸ–¼ï¸</button>
                            </div>
                            <div class="editor-content" contenteditable="true" id="newsletterBody" placeholder="ë‰´ìŠ¤ë ˆí„° ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></div>
                        </div>
                        <div style="display:flex;gap:12px;">
                            <button class="btn btn-secondary" id="previewNewsletterBtn">ë¯¸ë¦¬ë³´ê¸°</button>
                            <button class="btn btn-primary" id="sendNewsletterBtn">ë°œì†¡í•˜ê¸°</button>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ë¯¸ë¦¬ë³´ê¸°</h3>
                        </div>
                        <div class="newsletter-preview" id="newsletterPreview">
                            <div class="newsletter-header">
                                <h2 style="font-size:24px;font-weight:700;margin-bottom:8px;">ë¹„ë“œë°”ì´ì½”ë¦¬ì•„</h2>
                                <p style="opacity:0.9;">ì¼ë³¸ êµ¬ë§¤ëŒ€í–‰ 20ë…„ ì „í†µ</p>
                            </div>
                            <div class="newsletter-body">
                                <p style="color:var(--toss-gray-500);text-align:center;">ì™¼ìª½ì—ì„œ ë‚´ìš©ì„ ì…ë ¥í•˜ë©´<br>ì—¬ê¸°ì— ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
        }

        function renderNewsletterAI() {
            return `
            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">AI ì½˜í…ì¸  ìƒì„±</h3>
                    </div>

                    ${!state.geminiApiKey ? `
                    <div style="padding:16px;background:var(--toss-yellow-light);border-radius:12px;margin-bottom:20px;">
                        <p style="color:var(--toss-yellow);font-size:14px;">âš ï¸ Gemini API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. <button style="color:var(--toss-blue);background:none;border:none;cursor:pointer;text-decoration:underline;" data-page="settings">ì„¤ì •</button>ì—ì„œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                    </div>
                    ` : ''}

                    <div class="form-group">
                        <label class="form-label">ì½˜í…ì¸  ìœ í˜•</label>
                        <select id="aiContentType" class="form-input form-select">
                            <option value="newsletter">ğŸ“§ ë‰´ìŠ¤ë ˆí„° ë³¸ë¬¸</option>
                            <option value="blog">ğŸ“ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸</option>
                            <option value="sns">ğŸ“± SNS í¬ìŠ¤íŠ¸</option>
                            <option value="product_desc">ğŸ·ï¸ ìƒí’ˆ ì„¤ëª…</option>
                            <option value="weekly_insight">ğŸ“Š ì£¼ê°„ ì¸ì‚¬ì´íŠ¸</option>
                        </select>
                    </div>

                    <div style="padding:16px;background:var(--toss-blue-light);border-radius:12px;margin-bottom:20px;">
                        <p style="color:var(--toss-blue);font-size:14px;">ğŸ’¡ í˜„ì¬ ${state.trendData.length}ê°œ í‚¤ì›Œë“œ, ${state.weekInfo.month}ì›” ${state.weekInfo.week}ì£¼ì°¨ ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.</p>
                    </div>

                    <button class="btn btn-primary" style="width:100%;" id="generateAIBtn" ${!state.geminiApiKey ? 'disabled' : ''}>
                        ${state.isGenerating ? '<span class="spinner"></span> ìƒì„± ì¤‘...' : 'âœ¨ AI ì½˜í…ì¸  ìƒì„±'}
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ìƒì„±ëœ ì½˜í…ì¸ </h3>
                        <button class="btn btn-secondary btn-sm" id="copyAIContentBtn">ğŸ“‹ ë³µì‚¬</button>
                    </div>
                    <div style="background:var(--toss-gray-900);border-radius:12px;padding:20px;min-height:400px;">
                        <pre id="aiGeneratedContent" style="color:var(--toss-white);font-size:14px;line-height:1.8;white-space:pre-wrap;font-family:inherit;">AI ì½˜í…ì¸ ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
                    </div>
                </div>
            </div>`;
        }

        function renderNewsletterHistory() {
            return `
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ë°œì†¡ ë‚´ì—­</h3>
                </div>
                ${state.newsletters.length > 0 ? `
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ì œëª©</th>
                                <th>ë°œì†¡ì¼</th>
                                <th>ìˆ˜ì‹ ì</th>
                                <th>ìƒíƒœ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.newsletters.map(nl => `
                            <tr>
                                <td style="font-weight:600;">${nl.title}</td>
                                <td>${nl.sentAt}</td>
                                <td>${nl.recipients}ëª…</td>
                                <td><span class="badge badge-green">ë°œì†¡ì™„ë£Œ</span></td>
                            </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : `
                <div class="empty-state">
                    <div class="empty-icon">âœ‰ï¸</div>
                    <div class="empty-title">ë°œì†¡ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>
                    <div class="empty-desc">ì²« ë²ˆì§¸ ë‰´ìŠ¤ë ˆí„°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”</div>
                </div>
                `}
            </div>`;
        }

        function renderSubscribers() {
            return `
            <div class="page-header">
                <h1 class="page-title">êµ¬ë…ì ê´€ë¦¬</h1>
                <p class="page-desc">ë‰´ìŠ¤ë ˆí„° êµ¬ë…ìë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
            </div>

            <div class="stats-grid" style="grid-template-columns:repeat(3,1fr);">
                <div class="stat-card">
                    <div class="stat-label">ì „ì²´ êµ¬ë…ì</div>
                    <div class="stat-value">${state.subscribers.length}ëª…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">í™œì„± êµ¬ë…ì</div>
                    <div class="stat-value">${state.subscribers.filter(s => s.subscribed).length}ëª…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">êµ¬ë… í•´ì§€</div>
                    <div class="stat-value">${state.subscribers.filter(s => !s.subscribed).length}ëª…</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">êµ¬ë…ì ëª©ë¡</h3>
                    <div style="display:flex;gap:8px;">
                        <button class="btn btn-secondary btn-sm" id="exportSubscribersBtn">ğŸ“¥ ë‚´ë³´ë‚´ê¸°</button>
                        <button class="btn btn-primary btn-sm" id="addSubscriberBtn">+ ì¶”ê°€</button>
                    </div>
                </div>

                ${state.subscribers.length > 0 ? `
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ì´ë¦„</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ê°€ì…ì¼</th>
                                <th>ìƒíƒœ</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.subscribers.map(sub => `
                            <tr>
                                <td style="font-weight:600;">${sub.name}</td>
                                <td>${sub.email}</td>
                                <td>${sub.createdAt}</td>
                                <td><span class="badge ${sub.subscribed ? 'badge-green' : 'badge-red'}">${sub.subscribed ? 'êµ¬ë…ì¤‘' : 'í•´ì§€'}</span></td>
                                <td>
                                    <button class="btn btn-ghost btn-sm toggle-sub-btn" data-id="${sub.id}">${sub.subscribed ? 'í•´ì§€' : 'ì¬êµ¬ë…'}</button>
                                    <button class="btn btn-ghost btn-sm delete-sub-btn" data-id="${sub.id}" style="color:var(--toss-red);">ì‚­ì œ</button>
                                </td>
                            </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : `
                <div class="empty-state">
                    <div class="empty-icon">ğŸ‘¥</div>
                    <div class="empty-title">êµ¬ë…ìê°€ ì—†ìŠµë‹ˆë‹¤</div>
                    <div class="empty-desc">ìƒˆë¡œìš´ êµ¬ë…ìë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>
                </div>
                `}
            </div>`;
        }

        function renderSettings() {
            const isApiKeySet = state.geminiApiKey && state.geminiApiKey.length > 10;

            return `
            <div class="page-header">
                <h1 class="page-title">ì„¤ì •</h1>
                <p class="page-desc">ì‹œìŠ¤í…œ ì„¤ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
            </div>

            <div class="card" style="max-width:640px;">
                <div class="card-header">
                    <h3 class="card-title">ğŸ¤– Gemini AI ì„¤ì •</h3>
                    ${isApiKeySet ?
                        '<span class="badge badge-green">ì—°ê²°ë¨</span>' :
                        '<span class="badge badge-red">ë¯¸ì—°ê²°</span>'
                    }
                </div>

                <div style="padding:20px;background:var(--toss-blue-light);border-radius:12px;margin-bottom:20px;">
                    <p style="color:var(--toss-blue);font-size:14px;line-height:1.7;">
                        <strong>AI ì½˜í…ì¸  ìƒì„±</strong>ì„ ì‚¬ìš©í•˜ë ¤ë©´ Google Gemini API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.<br>
                        ë‰´ìŠ¤ë ˆí„°, ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸, SNS ì½˜í…ì¸ ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>

                <div class="form-group">
                    <label class="form-label">Gemini API í‚¤</label>
                    <div style="display:flex;gap:8px;">
                        <input type="${state.showApiKey ? 'text' : 'password'}" id="apiKeyInput" class="form-input" value="${state.geminiApiKey}" placeholder="AIzaSy..." style="flex:1;">
                        <button class="btn btn-secondary" id="toggleApiKeyBtn" style="min-width:80px;">
                            ${state.showApiKey ? 'ìˆ¨ê¸°ê¸°' : 'ë³´ê¸°'}
                        </button>
                    </div>
                </div>

                <div style="display:flex;gap:12px;margin-bottom:20px;">
                    <button class="btn btn-primary" id="saveApiKeyBtn" style="flex:1;">ğŸ’¾ API í‚¤ ì €ì¥</button>
                    <button class="btn btn-secondary" id="testApiKeyBtn" style="flex:1;">ğŸ” ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                </div>

                <div style="padding:16px;background:var(--toss-gray-50);border-radius:12px;">
                    <p style="font-size:14px;font-weight:600;color:var(--toss-gray-900);margin-bottom:12px;">ğŸ“‹ API í‚¤ ë°œê¸‰ ë°©ë²•</p>
                    <ol style="font-size:13px;color:var(--toss-gray-600);line-height:1.8;padding-left:20px;">
                        <li><a href="https://aistudio.google.com/app/apikey" target="_blank" style="color:var(--toss-blue);text-decoration:underline;">Google AI Studio</a> ì ‘ì†</li>
                        <li>Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</li>
                        <li>"Create API Key" ë²„íŠ¼ í´ë¦­</li>
                        <li>ìƒì„±ëœ API í‚¤ ë³µì‚¬ í›„ ìœ„ì— ë¶™ì—¬ë„£ê¸°</li>
                    </ol>
                    <p style="font-size:12px;color:var(--toss-gray-500);margin-top:12px;">
                        * Gemini APIëŠ” ë¬´ë£Œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì¼ì¼ ì‚¬ìš©ëŸ‰ ì œí•œ ìˆìŒ)
                    </p>
                </div>
            </div>

            <div class="card" style="max-width:640px;">
                <div class="card-header">
                    <h3 class="card-title">ğŸ“… ê¸°ê°„ ì„¤ì •</h3>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">ì›”</label>
                        <select id="monthSelect" class="form-input form-select">
                            ${[...Array(12)].map((_, i) => `<option value="${i+1}" ${state.weekInfo.month == i+1 ? 'selected' : ''}>${i+1}ì›”</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì£¼ì°¨</label>
                        <select id="weekSelect" class="form-input form-select">
                            ${[1,2,3,4,5].map(w => `<option value="${w}" ${state.weekInfo.week == w ? 'selected' : ''}>${w}ì£¼ì°¨</option>`).join('')}
                        </select>
                    </div>
                </div>
                <button class="btn btn-secondary" id="savePeriodBtn">ê¸°ê°„ ì €ì¥</button>
            </div>

            <div class="card" style="max-width:640px;">
                <div class="card-header">
                    <h3 class="card-title">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                    <button class="btn btn-secondary" id="exportAllBtn">
                        <span>ğŸ“¥</span> ì „ì²´ ë°±ì—…
                    </button>
                    <label class="btn btn-secondary" style="cursor:pointer;">
                        <span>ğŸ“¤</span> ë°±ì—… ë³µì›
                        <input type="file" id="importAllInput" accept=".json" style="display:none;">
                    </label>
                </div>
                <div style="margin-top:20px;padding-top:20px;border-top:1px solid var(--toss-gray-200);">
                    <button class="btn btn-secondary" id="clearAllBtn" style="width:100%;color:var(--toss-red);">
                        ğŸ—‘ï¸ ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”
                    </button>
                    <p style="font-size:12px;color:var(--toss-gray-500);margin-top:8px;text-align:center;">
                        * ì´ˆê¸°í™”í•˜ë©´ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ë©° ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤
                    </p>
                </div>
            </div>`;
        }

        // ============================================
        // ì°¨íŠ¸ ë Œë”ë§
        // ============================================
        function renderCharts() {
            const categories = Object.keys(state.categoryStats);

            // ì¹´í…Œê³ ë¦¬ ì°¨íŠ¸
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx && categories.length > 0) {
                new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: categories,
                        datasets: [{
                            data: categories.map(c => state.categoryStats[c].sales),
                            backgroundColor: ['#3182F6', '#F04452', '#30B06E', '#F59F00', '#8B95A1', '#6B7684'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }

            // ì£¼ê°„ ì°¨íŠ¸
            const weeklyCtx = document.getElementById('weeklyChart');
            if (weeklyCtx) {
                new Chart(weeklyCtx, {
                    type: 'line',
                    data: {
                        labels: ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'],
                        datasets: [{
                            label: 'íŒë§¤ê¸ˆì•¡',
                            data: [120000, 150000, 180000, 140000, 200000, 250000, 180000],
                            borderColor: '#3182F6',
                            backgroundColor: 'rgba(49, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }
        }

        function renderAnalysisCharts() {
            const categories = Object.keys(state.categoryStats);

            // íŒŒì´ ì°¨íŠ¸
            const pieCtx = document.getElementById('salesPieChart');
            if (pieCtx && categories.length > 0) {
                new Chart(pieCtx, {
                    type: 'pie',
                    data: {
                        labels: categories,
                        datasets: [{
                            data: categories.map(c => state.categoryStats[c].sales),
                            backgroundColor: ['#3182F6', '#F04452', '#30B06E', '#F59F00', '#8B95A1', '#6B7684', '#B0B8C1', '#D1D6DB'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }

            // ë°” ì°¨íŠ¸
            const barCtx = document.getElementById('quantityBarChart');
            if (barCtx && categories.length > 0) {
                new Chart(barCtx, {
                    type: 'bar',
                    data: {
                        labels: categories,
                        datasets: [{
                            label: 'íŒë§¤ìˆ˜ëŸ‰',
                            data: categories.map(c => state.categoryStats[c].quantity),
                            backgroundColor: '#3182F6',
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }
        }

        // ============================================
        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        // ============================================
        function attachEvents() {
            // ë¡œê·¸ì¸
            document.getElementById('loginBtn')?.addEventListener('click', () => {
                const id = document.getElementById('loginId').value;
                const pw = document.getElementById('loginPw').value;
                if (id === 'admin' && pw === 'admin123') {
                    state.isLoggedIn = true;
                    localStorage.setItem('isLoggedIn', 'true');
                    render();
                } else {
                    showToast('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤');
                }
            });

            // ë¡œê·¸ì•„ì›ƒ
            document.getElementById('logoutBtn')?.addEventListener('click', () => {
                state.isLoggedIn = false;
                localStorage.setItem('isLoggedIn', 'false');
                render();
            });

            // ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜
            document.querySelectorAll('.sidebar-link, [data-page]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const page = btn.dataset.page;
                    if (page) {
                        state.currentPage = page;
                        render();
                    }
                });
            });

            // íŒŒì¼ ì—…ë¡œë“œ
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');

            if (uploadZone && fileInput) {
                uploadZone.addEventListener('click', () => fileInput.click());

                uploadZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadZone.classList.add('dragover');
                });

                uploadZone.addEventListener('dragleave', () => {
                    uploadZone.classList.remove('dragover');
                });

                uploadZone.addEventListener('drop', async (e) => {
                    e.preventDefault();
                    uploadZone.classList.remove('dragover');
                    const file = e.dataTransfer.files[0];
                    if (file) await handleFileUpload(file);
                });

                fileInput.addEventListener('change', async (e) => {
                    const file = e.target.files[0];
                    if (file) await handleFileUpload(file);
                });
            }

            // ë°ì´í„° ì´ˆê¸°í™”
            document.getElementById('clearDataBtn')?.addEventListener('click', () => {
                if (confirm('ëª¨ë“  íŒë§¤ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    state.salesData = [];
                    saveState();
                    render();
                    showToast('ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            });

            // ì¹´í…Œê³ ë¦¬ í•„í„°
            document.querySelectorAll('.chip[data-category]').forEach(chip => {
                chip.addEventListener('click', () => {
                    state.selectedCategory = chip.dataset.category;
                    render();
                });
            });

            // íŠ¸ë Œë“œ ì¶”ê°€
            document.getElementById('addTrendBtn')?.addEventListener('click', () => {
                const keyword = prompt('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
                if (keyword) {
                    const newId = Math.max(...state.trendData.map(d => d.id), 0) + 1;
                    state.trendData.push({
                        id: newId,
                        keyword,
                        category: prompt('ì¹´í…Œê³ ë¦¬:') || 'ê¸°íƒ€',
                        searches: parseInt(prompt('ê²€ìƒ‰ëŸ‰:')) || 0,
                        change: parseInt(prompt('ë³€í™”ìœ¨(%):')) || 0,
                        price: parseInt(prompt('ê°€ê²©(ì—”):')) || 0
                    });
                    saveState();
                    render();
                    showToast('íŠ¸ë Œë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            });

            // íŠ¸ë Œë“œ ì‚­ì œ
            document.querySelectorAll('.delete-trend-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        const id = parseInt(btn.dataset.id);
                        state.trendData = state.trendData.filter(d => d.id !== id);
                        saveState();
                        render();
                        showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                    }
                });
            });

            // ë‰´ìŠ¤ë ˆí„° íƒ­
            document.querySelectorAll('.tab[data-tab]').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const content = document.getElementById('newsletterContent');
                    if (tab.dataset.tab === 'write') content.innerHTML = renderNewsletterWrite();
                    else if (tab.dataset.tab === 'ai') content.innerHTML = renderNewsletterAI();
                    else if (tab.dataset.tab === 'history') content.innerHTML = renderNewsletterHistory();
                    attachEvents();
                });
            });

            // AI ì½˜í…ì¸  ìƒì„±
            document.getElementById('generateAIBtn')?.addEventListener('click', async () => {
                state.isGenerating = true;
                render();

                try {
                    const type = document.getElementById('aiContentType')?.value || 'newsletter';
                    const prompt = buildAIPrompt(type);
                    const content = await generateWithGemini(prompt);
                    document.getElementById('aiGeneratedContent').textContent = content || 'ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤';
                } catch (error) {
                    showToast('ì˜¤ë¥˜: ' + error.message);
                }

                state.isGenerating = false;
            });

            // AI ì½˜í…ì¸  ë³µì‚¬
            document.getElementById('copyAIContentBtn')?.addEventListener('click', () => {
                const content = document.getElementById('aiGeneratedContent')?.textContent;
                if (content) {
                    navigator.clipboard.writeText(content);
                    showToast('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            });

            // API í‚¤ ì €ì¥
            document.getElementById('saveApiKeyBtn')?.addEventListener('click', () => {
                state.geminiApiKey = document.getElementById('apiKeyInput').value;
                localStorage.setItem('gemini_api_key', state.geminiApiKey);
                showToast('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                render();
            });

            // API í‚¤ ë³´ê¸°/ìˆ¨ê¸°ê¸°
            document.getElementById('toggleApiKeyBtn')?.addEventListener('click', () => {
                state.showApiKey = !state.showApiKey;
                render();
            });

            // API ì—°ê²° í…ŒìŠ¤íŠ¸
            document.getElementById('testApiKeyBtn')?.addEventListener('click', async () => {
                const apiKey = document.getElementById('apiKeyInput').value;
                if (!apiKey) {
                    showToast('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                    return;
                }

                showToast('ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...');

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: 'ì•ˆë…•' }] }],
                            generationConfig: { maxOutputTokens: 10 }
                        })
                    });

                    const data = await response.json();

                    if (data.candidates) {
                        showToast('âœ… API ì—°ê²° ì„±ê³µ! ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.');
                        state.geminiApiKey = apiKey;
                        localStorage.setItem('gemini_api_key', apiKey);
                        render();
                    } else if (data.error) {
                        showToast('âŒ ì˜¤ë¥˜: ' + data.error.message);
                    } else {
                        showToast('âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                    }
                } catch (error) {
                    showToast('âŒ ì—°ê²° ì‹¤íŒ¨: ' + error.message);
                }
            });

            // ê¸°ê°„ ì €ì¥
            document.getElementById('savePeriodBtn')?.addEventListener('click', () => {
                showToast('ê¸°ê°„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
            });

            // ê¸°ê°„ ì„¤ì •
            document.getElementById('monthSelect')?.addEventListener('change', (e) => {
                state.weekInfo.month = e.target.value;
            });
            document.getElementById('weekSelect')?.addEventListener('change', (e) => {
                state.weekInfo.week = e.target.value;
            });

            // ì „ì²´ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
            document.getElementById('exportAllBtn')?.addEventListener('click', () => {
                const data = {
                    salesData: state.salesData,
                    trendData: state.trendData,
                    newsletters: state.newsletters,
                    subscribers: state.subscribers,
                    weekInfo: state.weekInfo,
                    exportedAt: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `bidbuy_backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                showToast('ë°±ì—… íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤');
            });

            // ë°±ì—… ë³µì›
            document.getElementById('importAllInput')?.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.salesData) state.salesData = data.salesData;
                            if (data.trendData) state.trendData = data.trendData;
                            if (data.newsletters) state.newsletters = data.newsletters;
                            if (data.subscribers) state.subscribers = data.subscribers;
                            if (data.weekInfo) state.weekInfo = data.weekInfo;
                            saveState();
                            render();
                            showToast('ë°±ì—…ì´ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤');
                        } catch (err) {
                            showToast('ì˜ëª»ëœ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤');
                        }
                    };
                    reader.readAsText(file);
                }
            });

            // êµ¬ë…ì í† ê¸€
            document.querySelectorAll('.toggle-sub-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = parseInt(btn.dataset.id);
                    const sub = state.subscribers.find(s => s.id === id);
                    if (sub) {
                        sub.subscribed = !sub.subscribed;
                        saveState();
                        render();
                    }
                });
            });

            // êµ¬ë…ì ì‚­ì œ
            document.querySelectorAll('.delete-sub-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        const id = parseInt(btn.dataset.id);
                        state.subscribers = state.subscribers.filter(s => s.id !== id);
                        saveState();
                        render();
                        showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                    }
                });
            });

            // êµ¬ë…ì ì¶”ê°€
            document.getElementById('addSubscriberBtn')?.addEventListener('click', () => {
                const email = prompt('ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”:');
                if (email) {
                    const newId = Math.max(...state.subscribers.map(s => s.id), 0) + 1;
                    state.subscribers.push({
                        id: newId,
                        email,
                        name: prompt('ì´ë¦„:') || 'ìµëª…',
                        subscribed: true,
                        createdAt: new Date().toISOString().split('T')[0]
                    });
                    saveState();
                    render();
                    showToast('êµ¬ë…ìê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            });

            // ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”
            document.getElementById('clearAllBtn')?.addEventListener('click', () => {
                if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                    localStorage.clear();
                    location.reload();
                }
            });
        }

        async function handleFileUpload(file) {
            try {
                showToast('íŒŒì¼ì„ ë¶„ì„ì¤‘ì…ë‹ˆë‹¤...');
                const data = await parseExcel(file);
                state.salesData = data;
                saveState();
                render();
                showToast(`${data.length}ê±´ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤`);
            } catch (error) {
                showToast('íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                console.error(error);
            }
        }

        function buildAIPrompt(type) {
            const top5 = state.trendData.slice(0, 5);
            const totalSearches = state.trendData.reduce((s, d) => s + d.searches, 0);
            const categories = [...new Set(state.trendData.map(d => d.category))];

            const dataContext = `
[ë°ì´í„°]
- ê¸°ê°„: ${state.weekInfo.month}ì›” ${state.weekInfo.week}ì£¼ì°¨
- ì´ ê²€ìƒ‰ëŸ‰: ${totalSearches.toLocaleString()}ê±´
- TOP 5 ì¸ê¸° í‚¤ì›Œë“œ:
${top5.map((item, i) => `  ${i+1}. ${item.keyword} (${item.category}) - ${item.searches}ê±´, ì „ì£¼ëŒ€ë¹„ ${item.change >= 0 ? '+' : ''}${item.change}%`).join('\n')}
- ì£¼ìš” ì¹´í…Œê³ ë¦¬: ${categories.join(', ')}
`;

            const prompts = {
                newsletter: `ë‹¹ì‹ ì€ ë¹„ë“œë°”ì´ì½”ë¦¬ì•„(ì¼ë³¸ êµ¬ë§¤ëŒ€í–‰ 20ë…„ ì „í†µ)ì˜ ë§ˆì¼€íŒ… ë‹´ë‹¹ìì…ë‹ˆë‹¤.
ì•„ë˜ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê³ ê°ì—ê²Œ ë³´ë‚¼ ë‰´ìŠ¤ë ˆí„° ë³¸ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.

${dataContext}

[ì‘ì„± ê°€ì´ë“œ]
- í†¤: ì¹œê·¼í•˜ê³  ëŒ€í™”í•˜ë“¯ì´, í•˜ì§€ë§Œ ì „ë¬¸ì„±ë„ ëŠê»´ì§€ê²Œ
- ì´ëª¨ì§€ ì ì ˆíˆ í™œìš© (ê³¼í•˜ì§€ ì•Šê²Œ)
- 300~400ì ë‚´ì™¸

ìì—°ìŠ¤ëŸ½ê³  ì½ê³  ì‹¶ì€ ë‰´ìŠ¤ë ˆí„° ë³¸ë¬¸ë§Œ ì‘ì„±í•´ì£¼ì„¸ìš”.`,
                blog: `ì¼ë³¸ êµ¬ë§¤ëŒ€í–‰ ì „ë¬¸ ë¸”ë¡œê±°ë¡œì„œ SEOì— ì¢‹ì€ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.\n${dataContext}\n600~800ì, ì œëª© í¬í•¨`,
                sns: `ë¹„ë“œë°”ì´ì½”ë¦¬ì•„ SNS ë‹´ë‹¹ìë¡œì„œ ì¸ìŠ¤íƒ€ê·¸ë¨ìš© í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.\n${dataContext}\n150ì ë‚´ì™¸, í•´ì‹œíƒœê·¸ í¬í•¨`,
                product_desc: `1ìœ„ ìƒí’ˆ ${top5[0]?.keyword}ì— ëŒ€í•œ ìƒì„¸ ì„¤ëª…ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.\n${dataContext}\n200~300ì`,
                weekly_insight: `ë‚´ë¶€ ê³µìœ ìš© ì£¼ê°„ ì¸ì‚¬ì´íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.\n${dataContext}\n500ì ë‚´ì™¸`
            };

            return prompts[type] || prompts.newsletter;
        }

        // ì´ˆê¸° ë Œë”ë§
        render();
    </script>
</body>
</html>
