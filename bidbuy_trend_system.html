<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹„ë“œë°”ì´ íŠ¸ë Œë“œ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { font-family: 'Malgun Gothic', -apple-system, sans-serif; }
        .loading { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app"></div>

    <script>
        // ============================================
        // ìƒíƒœ ê´€ë¦¬
        // ============================================
        const state = {
            isLoggedIn: false,
            activeTab: 'dashboard',
            weekInfo: { month: '12', week: '1' },
            geminiApiKey: localStorage.getItem('gemini_api_key') || '',
            isGenerating: false,
            generatedContent: '',
            selectedContentType: 'newsletter',
            trendData: [
                { id: 1, rank: 1, keyword: 'ë¯¸ì¦ˆë…¸ ê¸€ëŸ¬ë¸Œ', category: 'ì•¼êµ¬ìš©í’ˆ', searches: 347, change: 23, price: 15000 },
                { id: 2, rank: 2, keyword: 'ì›í”¼ìŠ¤ í”¼ê·œì–´', category: 'í”¼ê·œì–´', searches: 282, change: 45, price: 8500 },
                { id: 3, rank: 3, keyword: 'ì•„ì‹ìŠ¤ ë°°íŠ¸', category: 'ì•¼êµ¬ìš©í’ˆ', searches: 269, change: 12, price: 25000 },
                { id: 4, rank: 4, keyword: 'ê±´ë‹´ í”„ë¼ëª¨ë¸', category: 'í”¼ê·œì–´', searches: 228, change: 8, price: 4500 },
                { id: 5, rank: 5, keyword: 'í¬ì¼“ëª¬ ì¹´ë“œ', category: 'ì™„êµ¬', searches: 217, change: 31, price: 3000 },
                { id: 6, rank: 6, keyword: 'ì‹œì„¸ì´ë„ ì„ í¬ë¦¼', category: 'ë·°í‹°', searches: 190, change: 15, price: 2800 },
                { id: 7, rank: 7, keyword: 'ì¹¼ë¹„ ê°ìì¹©', category: 'ì‹í’ˆ', searches: 172, change: -5, price: 500 },
                { id: 8, rank: 8, keyword: 'SK-II ì—ì„¼ìŠ¤', category: 'ë·°í‹°', searches: 165, change: 18, price: 18000 },
            ],
            editingId: null,
            editForm: {}
        };

        // ============================================
        // Gemini API ì—°ë™
        // ============================================
        async function generateWithGemini(prompt) {
            if (!state.geminiApiKey) {
                alert('Gemini API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return null;
            }

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${state.geminiApiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        temperature: 0.8,
                        topK: 40,
                        topP: 0.95,
                        maxOutputTokens: 2048,
                    }
                })
            });

            const data = await response.json();
            if (data.candidates && data.candidates[0]) {
                return data.candidates[0].content.parts[0].text;
            }
            throw new Error(data.error?.message || 'API ì˜¤ë¥˜');
        }

        // ============================================
        // AI í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ (ìì—°ìŠ¤ëŸ¬ìš´ í†¤)
        // ============================================
        function buildPrompt(type) {
            const { trendData, weekInfo } = state;
            const top5 = trendData.slice(0, 5);
            const totalSearches = trendData.reduce((s, d) => s + d.searches, 0);
            const risingItems = trendData.filter(d => d.change >= 20);
            const categories = [...new Set(trendData.map(d => d.category))];

            const dataContext = `
[ë°ì´í„°]
- ê¸°ê°„: ${weekInfo.month}ì›” ${weekInfo.week}ì£¼ì°¨
- ì´ ê²€ìƒ‰ëŸ‰: ${totalSearches.toLocaleString()}ê±´
- TOP 5 ì¸ê¸° í‚¤ì›Œë“œ:
${top5.map((item, i) => `  ${i+1}. ${item.keyword} (${item.category}) - ${item.searches}ê±´, ì „ì£¼ëŒ€ë¹„ ${item.change >= 0 ? '+' : ''}${item.change}%`).join('\n')}
- ê¸‰ìƒìŠ¹ í‚¤ì›Œë“œ (20% ì´ìƒ): ${risingItems.map(i => `${i.keyword}(+${i.change}%)`).join(', ') || 'ì—†ìŒ'}
- ì£¼ìš” ì¹´í…Œê³ ë¦¬: ${categories.join(', ')}
- ì „ì²´ ë°ì´í„°:
${trendData.map(item => `  - ${item.keyword}: ${item.category}, ${item.searches}ê±´, ${item.change}%, ${item.price?.toLocaleString()}ì—”`).join('\n')}
`;

            const prompts = {
                newsletter: `ë‹¹ì‹ ì€ ë¹„ë“œë°”ì´ì½”ë¦¬ì•„(ì¼ë³¸ êµ¬ë§¤ëŒ€í–‰ 20ë…„ ì „í†µ)ì˜ ë§ˆì¼€íŒ… ë‹´ë‹¹ìì…ë‹ˆë‹¤.
ì•„ë˜ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê³ ê°ì—ê²Œ ë³´ë‚¼ ë‰´ìŠ¤ë ˆí„° ë³¸ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.

${dataContext}

[ì‘ì„± ê°€ì´ë“œ]
- í†¤: ì¹œê·¼í•˜ê³  ëŒ€í™”í•˜ë“¯ì´, í•˜ì§€ë§Œ ì „ë¬¸ì„±ë„ ëŠê»´ì§€ê²Œ
- ë”±ë”±í•œ ë¦¬í¬íŠ¸ ë§ê³ , ì¹œêµ¬ê°€ "ì•¼ ì´ê±° ìš”ì¦˜ ì§„ì§œ ë§ì´ ì°¾ë”ë¼" í•˜ê³  ì•Œë ¤ì£¼ëŠ” ëŠë‚Œ
- ì´ëª¨ì§€ ì ì ˆíˆ í™œìš© (ê³¼í•˜ì§€ ì•Šê²Œ)
- ì™œ ì´ ìƒí’ˆë“¤ì´ ì¸ê¸°ì¸ì§€ ë§¥ë½/ìŠ¤í† ë¦¬ ì„¤ëª…
- ìì—°ìŠ¤ëŸ½ê²Œ êµ¬ë§¤ ìœ ë„ (ê°•ë§¤ ëŠë‚Œ ì—†ì´)
- ë¹„ë“œë°”ì´ë§Œì˜ ì¥ì  ìì—°ìŠ¤ëŸ½ê²Œ ë…¹ì´ê¸° (20ë…„ ê²½í—˜, ë¹ ë¥¸ ë°°ì†¡, í˜„ì§€ ì°½ê³ )
- 300~400ì ë‚´ì™¸

[í”¼í•´ì•¼ í•  ê²ƒ]
- "ì•ˆë…•í•˜ì„¸ìš”, OOOì…ë‹ˆë‹¤" ê°™ì€ ë»”í•œ ì¸ì‚¬
- ìˆ«ì ë‚˜ì—´ë§Œ í•˜ëŠ” ê±´ì¡°í•œ ê¸€
- "~í–ˆìŠµë‹ˆë‹¤" ë°˜ë³µë˜ëŠ” ë¬¸ì–´ì²´
- ê³¼ë„í•œ ì´ëª¨ì§€
- ì˜ì—… ëŠë‚Œ ê°•í•œ ë§ˆë¬´ë¦¬

ìì—°ìŠ¤ëŸ½ê³  ì½ê³  ì‹¶ì€ ë‰´ìŠ¤ë ˆí„° ë³¸ë¬¸ë§Œ ì‘ì„±í•´ì£¼ì„¸ìš”.`,

                blog: `ë‹¹ì‹ ì€ ì¼ë³¸ êµ¬ë§¤ëŒ€í–‰ ì „ë¬¸ ë¸”ë¡œê±°ì…ë‹ˆë‹¤.
ì•„ë˜ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ SEOì— ì¢‹ì€ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

${dataContext}

[ì‘ì„± ê°€ì´ë“œ]
- ì œëª© í¬í•¨ (í´ë¦­í•˜ê³  ì‹¶ì€ ì œëª©)
- ì„œë¡ : ìš”ì¦˜ ë­ê°€ í•«í•œì§€ ìì—°ìŠ¤ëŸ½ê²Œ ì‹œì‘
- ë³¸ë¡ : TOP 3~5 ìƒí’ˆ ê°ê° ì™œ ì¸ê¸°ì¸ì§€, ì–´ë–¤ ì‚¬ëŒë“¤ì´ ì°¾ëŠ”ì§€
- ì‹¤ì œë¡œ êµ¬ë§¤í•  ë•Œ íŒì´ë‚˜ ì£¼ì˜ì 
- ê²°ë¡ : ë¶€ë‹´ì—†ëŠ” ë§ˆë¬´ë¦¬
- 600~800ì ë‚´ì™¸
- ì†Œì œëª© 2~3ê°œ í™œìš©
- ê²€ìƒ‰ í‚¤ì›Œë“œ ìì—°ìŠ¤ëŸ½ê²Œ í¬í•¨

ë¸”ë¡œê·¸ ê¸€ ì „ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.`,

                sns: `ë‹¹ì‹ ì€ ë¹„ë“œë°”ì´ì½”ë¦¬ì•„ SNS ë‹´ë‹¹ìì…ë‹ˆë‹¤.
ì•„ë˜ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¸ìŠ¤íƒ€ê·¸ë¨/í˜ì´ìŠ¤ë¶ìš© í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

${dataContext}

[ì‘ì„± ê°€ì´ë“œ]
- ì§§ê³  ì„íŒ©íŠ¸ ìˆê²Œ (150ì ë‚´ì™¸)
- í˜¸ê¸°ì‹¬ ìœ ë°œí•˜ëŠ” ì²« ë¬¸ì¥
- í•µì‹¬ 1~2ê°œ ìƒí’ˆë§Œ ì–¸ê¸‰
- í•´ì‹œíƒœê·¸ 5~7ê°œ
- ì´ëª¨ì§€ í™œìš©
- "ì§€ê¸ˆ ë°”ë¡œ í™•ì¸" ê°™ì€ CTA

SNS í¬ìŠ¤íŠ¸ ì „ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.`,

                product_desc: `ë‹¹ì‹ ì€ ìƒí’ˆ ìƒì„¸í˜ì´ì§€ ì¹´í”¼ë¼ì´í„°ì…ë‹ˆë‹¤.
ì•„ë˜ 1ìœ„ ìƒí’ˆì— ëŒ€í•œ ìƒì„¸ ì„¤ëª…ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.

${dataContext}

[ì‘ì„± ëŒ€ìƒ]
1ìœ„ ìƒí’ˆ: ${top5[0]?.keyword} (${top5[0]?.category})

[ì‘ì„± ê°€ì´ë“œ]
- ìƒí’ˆì˜ ë§¤ë ¥ í¬ì¸íŠ¸ 3ê°€ì§€
- ì™œ ì¼ë³¸ì—ì„œ ì‚¬ì•¼ í•˜ëŠ”ì§€ (ê°€ê²©, í’ˆì§ˆ, í•œì •íŒ ë“±)
- ì–´ë–¤ ë¶„ê»˜ ì¶”ì²œí•˜ëŠ”ì§€
- ë¹„ë“œë°”ì´ë¡œ êµ¬ë§¤í•˜ë©´ ì¢‹ì€ ì 
- 200~300ì
- êµ¬ë§¤ìš• ìê·¹í•˜ëŠ” í†¤

ìƒí’ˆ ì„¤ëª… ì „ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.`,

                weekly_insight: `ë‹¹ì‹ ì€ ì´ì»¤ë¨¸ìŠ¤ ë°ì´í„° ë¶„ì„ê°€ì…ë‹ˆë‹¤.
ì•„ë˜ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‚´ë¶€ ê³µìœ ìš© ì£¼ê°„ ì¸ì‚¬ì´íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

${dataContext}

[ì‘ì„± ê°€ì´ë“œ]
- ì´ë²ˆ ì£¼ í•µì‹¬ ë°œê²¬ 3ê°€ì§€
- ì „ì£¼ ëŒ€ë¹„ ë³€í™” ë¶„ì„
- ì¹´í…Œê³ ë¦¬ë³„ ë™í–¥
- ë‹¤ìŒ ì£¼ ì˜ˆì¸¡/ì œì•ˆ
- ë§ˆì¼€íŒ… ì•¡ì…˜ ì•„ì´í…œ
- ê°ê´€ì ì´ê³  ë¶„ì„ì ì¸ í†¤
- 500ì ë‚´ì™¸

ë‚´ë¶€ ë¦¬í¬íŠ¸ ì „ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.`
            };

            return prompts[type] || prompts.newsletter;
        }

        // ============================================
        // ë Œë”ë§ í•¨ìˆ˜ë“¤
        // ============================================
        function render() {
            const app = document.getElementById('app');
            
            if (!state.isLoggedIn) {
                app.innerHTML = renderLogin();
            } else {
                app.innerHTML = renderDashboard();
            }
            
            attachEvents();
        }

        function renderLogin() {
            return `
            <div class="min-h-screen bg-gradient-to-br from-blue-900 to-slate-900 flex items-center justify-center p-4">
                <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
                    <div class="bg-gradient-to-r from-blue-600 to-blue-700 p-10 text-center">
                        <div class="text-3xl font-bold text-white mb-2">BIDBUY</div>
                        <div class="text-blue-200 text-sm">íŠ¸ë Œë“œ ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
                    </div>
                    <div class="p-8">
                        <div class="mb-5">
                            <label class="block text-gray-700 text-sm font-medium mb-2">ì•„ì´ë””</label>
                            <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="admin">
                        </div>
                        <div class="mb-5">
                            <label class="block text-gray-700 text-sm font-medium mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                        </div>
                        <div id="loginError" class="mb-4 p-3 bg-red-50 border border-red-200 text-red-600 rounded-lg text-sm hidden"></div>
                        <button id="loginBtn" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition">
                            ë¡œê·¸ì¸
                        </button>
                        <p class="text-center text-gray-400 text-xs mt-4">ID: admin / PW: admin123</p>
                    </div>
                </div>
            </div>`;
        }

        function renderDashboard() {
            return `
            <nav class="bg-white shadow-sm border-b">
                <div class="max-w-6xl mx-auto px-4 flex justify-between items-center h-14">
                    <div class="flex items-center gap-2">
                        <span class="text-xl">ğŸ“ˆ</span>
                        <span class="font-bold text-lg">ë¹„ë“œë°”ì´ íŠ¸ë Œë“œ</span>
                    </div>
                    <button id="logoutBtn" class="text-gray-500 hover:text-red-600 text-sm">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </nav>

            <div class="bg-white border-b">
                <div class="max-w-6xl mx-auto px-4 flex gap-1">
                    ${['dashboard', 'data', 'content', 'preview', 'settings'].map(tab => `
                        <button class="tab-btn px-4 py-3 text-sm border-b-2 ${state.activeTab === tab ? 'border-blue-600 text-blue-600 font-semibold' : 'border-transparent text-gray-500'}" data-tab="${tab}">
                            ${{dashboard: 'ğŸ“Š ëŒ€ì‹œë³´ë“œ', data: 'âš™ï¸ ë°ì´í„°', content: 'âœï¸ AI ì½˜í…ì¸ ', preview: 'ğŸ‘ï¸ ìœ„ì ¯', settings: 'ğŸ”‘ ì„¤ì •'}[tab]}
                        </button>
                    `).join('')}
                </div>
            </div>

            <div class="max-w-6xl mx-auto px-4 py-6">
                ${state.activeTab === 'dashboard' ? renderDashboardTab() : ''}
                ${state.activeTab === 'data' ? renderDataTab() : ''}
                ${state.activeTab === 'content' ? renderContentTab() : ''}
                ${state.activeTab === 'preview' ? renderPreviewTab() : ''}
                ${state.activeTab === 'settings' ? renderSettingsTab() : ''}
            </div>`;
        }

        function renderDashboardTab() {
            const totalSearches = state.trendData.reduce((s, d) => s + d.searches, 0);
            return `
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-xl p-5 shadow-sm">
                    <div class="text-gray-500 text-sm">ì´ í‚¤ì›Œë“œ</div>
                    <div class="text-3xl font-bold mt-1">${state.trendData.length}</div>
                </div>
                <div class="bg-white rounded-xl p-5 shadow-sm">
                    <div class="text-gray-500 text-sm">ì´ ê²€ìƒ‰ëŸ‰</div>
                    <div class="text-3xl font-bold text-blue-600 mt-1">${totalSearches.toLocaleString()}</div>
                </div>
                <div class="bg-white rounded-xl p-5 shadow-sm">
                    <div class="text-gray-500 text-sm">í˜„ì¬ ê¸°ê°„</div>
                    <div class="text-3xl font-bold mt-1">${state.weekInfo.month}ì›” ${state.weekInfo.week}ì£¼ì°¨</div>
                </div>
                <div class="md:col-span-3 bg-white rounded-xl p-5 shadow-sm">
                    <h3 class="font-bold mb-4">ğŸ”¥ TOP 5 í‚¤ì›Œë“œ</h3>
                    ${state.trendData.slice(0, 5).map((item, i) => `
                        <div class="flex items-center gap-3 mb-3">
                            <div class="w-7 h-7 rounded-full ${i < 3 ? 'bg-red-500' : 'bg-blue-500'} text-white flex items-center justify-center text-xs font-bold">${item.rank}</div>
                            <div class="flex-1">
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="font-medium">${item.keyword}</span>
                                    <span class="text-gray-400">${item.searches.toLocaleString()}</span>
                                </div>
                                <div class="h-2 bg-gray-100 rounded-full overflow-hidden">
                                    <div class="h-full ${i < 3 ? 'bg-red-500' : 'bg-blue-500'} rounded-full" style="width: ${(item.searches / state.trendData[0].searches) * 100}%"></div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>`;
        }

        function renderDataTab() {
            return `
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                <div class="p-4 bg-gray-50 border-b flex flex-wrap gap-3 items-center">
                    <span class="text-gray-600 text-sm">ê¸°ê°„:</span>
                    <select id="monthSelect" class="px-3 py-2 border rounded-lg text-sm">
                        ${[...Array(12)].map((_, i) => `<option value="${i+1}" ${state.weekInfo.month == i+1 ? 'selected' : ''}>${i+1}ì›”</option>`).join('')}
                    </select>
                    <select id="weekSelect" class="px-3 py-2 border rounded-lg text-sm">
                        ${[1,2,3,4,5].map(w => `<option value="${w}" ${state.weekInfo.week == w ? 'selected' : ''}>${w}ì£¼ì°¨</option>`).join('')}
                    </select>
                    <div class="flex-1"></div>
                    <button id="addItemBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700">+ ì¶”ê°€</button>
                    <button id="exportBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700">ğŸ“¥ ë‚´ë³´ë‚´ê¸°</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="px-4 py-3 text-left font-medium text-gray-600">ìˆœìœ„</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600">í‚¤ì›Œë“œ</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600">ì¹´í…Œê³ ë¦¬</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600">ê²€ìƒ‰ëŸ‰</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600">ë³€í™”</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600">ê°€ê²©(ì—”)</th>
                                <th class="px-4 py-3 text-center font-medium text-gray-600">ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${state.trendData.map(item => `
                                <tr class="border-b hover:bg-gray-50" data-id="${item.id}">
                                    <td class="px-4 py-3"><span class="inline-flex items-center justify-center w-6 h-6 rounded-full ${item.rank <= 3 ? 'bg-red-500' : 'bg-blue-500'} text-white text-xs font-bold">${item.rank}</span></td>
                                    <td class="px-4 py-3 font-medium">${item.keyword}</td>
                                    <td class="px-4 py-3 text-gray-500">${item.category}</td>
                                    <td class="px-4 py-3 text-blue-600 font-medium">${item.searches.toLocaleString()}</td>
                                    <td class="px-4 py-3"><span class="${item.change >= 0 ? 'text-red-500' : 'text-green-500'}">${item.change >= 0 ? 'â†‘' : 'â†“'}${Math.abs(item.change)}%</span></td>
                                    <td class="px-4 py-3 text-gray-500">${item.price?.toLocaleString() || '-'}</td>
                                    <td class="px-4 py-3 text-center">
                                        <button class="edit-btn px-2 py-1 bg-blue-100 text-blue-600 rounded text-xs mr-1" data-id="${item.id}">ìˆ˜ì •</button>
                                        <button class="delete-btn px-2 py-1 bg-red-100 text-red-600 rounded text-xs" data-id="${item.id}">ì‚­ì œ</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>`;
        }

        function renderContentTab() {
            return `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="font-bold text-lg mb-4">ğŸ¤– AI ì½˜í…ì¸  ìƒì„± (Gemini)</h3>
                    
                    ${!state.geminiApiKey ? `
                        <div class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <p class="text-yellow-800 text-sm">âš ï¸ Gemini API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. <button class="underline font-medium" onclick="state.activeTab='settings';render();">ì„¤ì •</button>ì—ì„œ API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                        </div>
                    ` : ''}
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì½˜í…ì¸  ìœ í˜•</label>
                        <select id="contentType" class="w-full px-4 py-3 border rounded-lg">
                            <option value="newsletter" ${state.selectedContentType === 'newsletter' ? 'selected' : ''}>ğŸ“§ ë‰´ìŠ¤ë ˆí„° ë³¸ë¬¸</option>
                            <option value="blog" ${state.selectedContentType === 'blog' ? 'selected' : ''}>ğŸ“ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸</option>
                            <option value="sns" ${state.selectedContentType === 'sns' ? 'selected' : ''}>ğŸ“± SNS í¬ìŠ¤íŠ¸</option>
                            <option value="product_desc" ${state.selectedContentType === 'product_desc' ? 'selected' : ''}>ğŸ·ï¸ ìƒí’ˆ ì„¤ëª…</option>
                            <option value="weekly_insight" ${state.selectedContentType === 'weekly_insight' ? 'selected' : ''}>ğŸ“Š ì£¼ê°„ ì¸ì‚¬ì´íŠ¸</option>
                        </select>
                    </div>
                    
                    <div class="mb-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800">
                        ğŸ’¡ í˜„ì¬ ${state.trendData.length}ê°œ í‚¤ì›Œë“œ, ${state.weekInfo.month}ì›” ${state.weekInfo.week}ì£¼ì°¨ ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.
                    </div>
                    
                    <button id="generateBtn" class="w-full py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg font-medium hover:from-purple-700 hover:to-indigo-700 disabled:opacity-50" ${!state.geminiApiKey ? 'disabled' : ''}>
                        ${state.isGenerating ? '<span class="loading">â³ ìƒì„± ì¤‘...</span>' : 'âœ¨ AI ì½˜í…ì¸  ìƒì„±'}
                    </button>
                    
                    <div class="mt-6 pt-6 border-t">
                        <h4 class="font-medium text-sm mb-3">ì½˜í…ì¸  ìœ í˜• ì„¤ëª…</h4>
                        <div class="text-xs text-gray-600 space-y-2">
                            <p>ğŸ“§ <b>ë‰´ìŠ¤ë ˆí„°</b>: ì¹œê·¼í•œ í†¤, êµ¬ë§¤ ìœ ë„ í¬í•¨</p>
                            <p>ğŸ“ <b>ë¸”ë¡œê·¸</b>: SEO ìµœì í™”, ìƒì„¸ ë¶„ì„</p>
                            <p>ğŸ“± <b>SNS</b>: ì§§ê³  ì„íŒ©íŠ¸, í•´ì‹œíƒœê·¸ í¬í•¨</p>
                            <p>ğŸ·ï¸ <b>ìƒí’ˆ ì„¤ëª…</b>: 1ìœ„ ìƒí’ˆ ìƒì„¸ ì¹´í”¼</p>
                            <p>ğŸ“Š <b>ì¸ì‚¬ì´íŠ¸</b>: ë‚´ë¶€ ê³µìœ ìš© ë¶„ì„</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg">ğŸ“ ìƒì„±ëœ ì½˜í…ì¸ </h3>
                        ${state.generatedContent ? `<button id="copyContentBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm">ğŸ“‹ ë³µì‚¬</button>` : ''}
                    </div>
                    <div class="bg-gray-900 rounded-lg p-4 min-h-[400px] max-h-[500px] overflow-auto">
                        <pre class="text-sm text-gray-100 whitespace-pre-wrap font-sans leading-relaxed">${state.generatedContent || 'ì™¼ìª½ì—ì„œ ì½˜í…ì¸  ìœ í˜• ì„ íƒ í›„\n"AI ì½˜í…ì¸  ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.'}</pre>
                    </div>
                </div>
            </div>`;
        }

        function renderPreviewTab() {
            const top3 = state.trendData.slice(0, 3);
            return `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="font-bold mb-4">ğŸ“± ìœ„ì ¯ ë¯¸ë¦¬ë³´ê¸°</h3>
                    <div class="border rounded-lg p-6 bg-gray-50">
                        <div class="max-w-xs mx-auto bg-white rounded-lg shadow p-4">
                            <h3 class="text-center text-lg mb-1">ë¹„ë“œë°”ì´<span class="text-blue-500 font-bold">íŠ¸ë Œë“œ</span></h3>
                            <p class="text-center text-gray-400 text-sm mb-4">${state.weekInfo.month}ì›” ${state.weekInfo.week}ì£¼ì°¨</p>
                            ${top3.map(item => `
                                <div class="flex items-center gap-3 py-3 border-b last:border-0">
                                    <div class="w-9 h-9 rounded-full ${item.rank <= 3 ? 'bg-red-500' : 'bg-blue-500'} text-white flex items-center justify-center font-bold text-sm">${item.rank}</div>
                                    <div class="flex-1">
                                        <div class="font-medium text-sm">${item.keyword}</div>
                                        <div class="text-xs text-gray-400">${item.category} | ğŸ”${item.searches} <span class="text-red-500">â†‘${item.change}%</span></div>
                                    </div>
                                </div>
                            `).join('')}
                            <button class="w-full mt-3 py-2 border rounded text-gray-500 text-sm">ë”ë³´ê¸° â†’</button>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold">ğŸ’» HTML ì½”ë“œ</h3>
                        <button id="copyWidgetBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm">ğŸ“‹ ë³µì‚¬</button>
                    </div>
                    <pre id="widgetCode" class="bg-gray-900 text-green-400 p-4 rounded-lg overflow-auto text-xs max-h-80">${generateWidgetHTML()}</pre>
                </div>
            </div>`;
        }

        function renderSettingsTab() {
            return `
            <div class="max-w-xl mx-auto">
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="font-bold text-lg mb-6">ğŸ”‘ API ì„¤ì •</h3>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Gemini API í‚¤</label>
                        <input type="password" id="apiKeyInput" value="${state.geminiApiKey}" class="w-full px-4 py-3 border rounded-lg" placeholder="AIzaSy...">
                        <p class="mt-2 text-xs text-gray-500">
                            <a href="https://makersuite.google.com/app/apikey" target="_blank" class="text-blue-600 underline">Google AI Studio</a>ì—ì„œ ë¬´ë£Œë¡œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                    
                    <button id="saveApiKeyBtn" class="w-full py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">
                        ì €ì¥
                    </button>
                    
                    <div class="mt-6 pt-6 border-t">
                        <h4 class="font-medium mb-3">ğŸ“‹ ë°ì´í„° ê´€ë¦¬</h4>
                        <div class="flex gap-3">
                            <button id="exportDataBtn" class="flex-1 py-2 border rounded-lg text-sm hover:bg-gray-50">ğŸ“¥ JSON ë‚´ë³´ë‚´ê¸°</button>
                            <label class="flex-1 py-2 border rounded-lg text-sm hover:bg-gray-50 cursor-pointer text-center">
                                ğŸ“¤ JSON ê°€ì ¸ì˜¤ê¸°
                                <input type="file" id="importDataInput" accept=".json" class="hidden">
                            </label>
                        </div>
                    </div>
                </div>
            </div>`;
        }

        function generateWidgetHTML() {
            const top3 = state.trendData.slice(0, 3);
            return `&lt;!-- ë¹„ë“œë°”ì´ íŠ¸ë Œë“œ ìœ„ì ¯ --&gt;
&lt;div style="max-width:400px;font-family:'Malgun Gothic',sans-serif"&gt;
  &lt;h3 style="text-align:center;font-size:18px"&gt;
    ë¹„ë“œë°”ì´&lt;span style="color:#2196F3;font-weight:bold"&gt;íŠ¸ë Œë“œ&lt;/span&gt;
    &lt;span style="display:block;font-size:14px;color:#888"&gt;${state.weekInfo.month}ì›” ${state.weekInfo.week}ì£¼ì°¨&lt;/span&gt;
  &lt;/h3&gt;
${top3.map(item => `  &lt;div style="display:flex;gap:15px;padding:15px 0;border-bottom:1px solid #f0f0f0"&gt;
    &lt;div style="width:40px;height:40px;background:#e74c3c;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold"&gt;${item.rank}&lt;/div&gt;
    &lt;div&gt;
      &lt;div style="font-size:14px;font-weight:500"&gt;${item.keyword}&lt;/div&gt;
      &lt;div style="font-size:12px;color:#888"&gt;${item.category} | ğŸ”${item.searches}ê±´ &lt;span style="color:#e74c3c"&gt;â†‘${item.change}%&lt;/span&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;`).join('\n')}
&lt;/div&gt;`;
        }

        // ============================================
        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        // ============================================
        function attachEvents() {
            // ë¡œê·¸ì¸
            document.getElementById('loginBtn')?.addEventListener('click', () => {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                if (username === 'admin' && password === 'admin123') {
                    state.isLoggedIn = true;
                    render();
                } else {
                    document.getElementById('loginError').textContent = 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                    document.getElementById('loginError').classList.remove('hidden');
                }
            });

            // ë¡œê·¸ì•„ì›ƒ
            document.getElementById('logoutBtn')?.addEventListener('click', () => {
                state.isLoggedIn = false;
                render();
            });

            // íƒ­ ì „í™˜
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    state.activeTab = btn.dataset.tab;
                    render();
                });
            });

            // ê¸°ê°„ ë³€ê²½
            document.getElementById('monthSelect')?.addEventListener('change', (e) => {
                state.weekInfo.month = e.target.value;
                render();
            });
            document.getElementById('weekSelect')?.addEventListener('change', (e) => {
                state.weekInfo.week = e.target.value;
                render();
            });

            // í•­ëª© ì¶”ê°€
            document.getElementById('addItemBtn')?.addEventListener('click', () => {
                const newId = Math.max(...state.trendData.map(d => d.id), 0) + 1;
                const keyword = prompt('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
                if (keyword) {
                    state.trendData.push({
                        id: newId,
                        rank: state.trendData.length + 1,
                        keyword: keyword,
                        category: prompt('ì¹´í…Œê³ ë¦¬:') || 'ê¸°íƒ€',
                        searches: parseInt(prompt('ê²€ìƒ‰ëŸ‰:')) || 0,
                        change: parseInt(prompt('ë³€í™”ìœ¨(%):')) || 0,
                        price: parseInt(prompt('ê°€ê²©(ì—”):')) || 0
                    });
                    render();
                }
            });

            // í•­ëª© ìˆ˜ì •
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = parseInt(btn.dataset.id);
                    const item = state.trendData.find(d => d.id === id);
                    if (item) {
                        item.keyword = prompt('í‚¤ì›Œë“œ:', item.keyword) || item.keyword;
                        item.category = prompt('ì¹´í…Œê³ ë¦¬:', item.category) || item.category;
                        item.searches = parseInt(prompt('ê²€ìƒ‰ëŸ‰:', item.searches)) || item.searches;
                        item.change = parseInt(prompt('ë³€í™”ìœ¨(%):', item.change)) ?? item.change;
                        item.price = parseInt(prompt('ê°€ê²©(ì—”):', item.price)) || item.price;
                        render();
                    }
                });
            });

            // í•­ëª© ì‚­ì œ
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        const id = parseInt(btn.dataset.id);
                        state.trendData = state.trendData.filter(d => d.id !== id);
                        state.trendData.forEach((d, i) => d.rank = i + 1);
                        render();
                    }
                });
            });

            // ì½˜í…ì¸  ìœ í˜• ë³€ê²½
            document.getElementById('contentType')?.addEventListener('change', (e) => {
                state.selectedContentType = e.target.value;
            });

            // AI ì½˜í…ì¸  ìƒì„±
            document.getElementById('generateBtn')?.addEventListener('click', async () => {
                state.isGenerating = true;
                render();
                
                try {
                    const prompt = buildPrompt(state.selectedContentType);
                    const content = await generateWithGemini(prompt);
                    state.generatedContent = content || 'ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                } catch (error) {
                    state.generatedContent = 'ì˜¤ë¥˜: ' + error.message;
                }
                
                state.isGenerating = false;
                render();
            });

            // ì½˜í…ì¸  ë³µì‚¬
            document.getElementById('copyContentBtn')?.addEventListener('click', () => {
                navigator.clipboard.writeText(state.generatedContent);
                alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });

            // ìœ„ì ¯ ì½”ë“œ ë³µì‚¬
            document.getElementById('copyWidgetBtn')?.addEventListener('click', () => {
                const code = document.getElementById('widgetCode').textContent
                    .replace(/&lt;/g, '<').replace(/&gt;/g, '>');
                navigator.clipboard.writeText(code);
                alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });

            // API í‚¤ ì €ì¥
            document.getElementById('saveApiKeyBtn')?.addEventListener('click', () => {
                state.geminiApiKey = document.getElementById('apiKeyInput').value;
                localStorage.setItem('gemini_api_key', state.geminiApiKey);
                alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                render();
            });

            // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
            document.getElementById('exportDataBtn')?.addEventListener('click', () => {
                const data = JSON.stringify({ weekInfo: state.weekInfo, trendData: state.trendData }, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `bidbuy_trend_${state.weekInfo.month}ì›”${state.weekInfo.week}ì£¼ì°¨.json`;
                a.click();
            });
            
            document.getElementById('exportBtn')?.addEventListener('click', () => {
                const data = JSON.stringify({ weekInfo: state.weekInfo, trendData: state.trendData }, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `bidbuy_trend_${state.weekInfo.month}ì›”${state.weekInfo.week}ì£¼ì°¨.json`;
                a.click();
            });

            // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            document.getElementById('importDataInput')?.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.trendData) state.trendData = data.trendData;
                            if (data.weekInfo) state.weekInfo = data.weekInfo;
                            alert('ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!');
                            render();
                        } catch (err) {
                            alert('ì˜ëª»ëœ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.');
                        }
                    };
                    reader.readAsText(file);
                }
            });
        }

        // ì´ˆê¸° ë Œë”ë§
        render();
    </script>
</body>
</html>
