<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¹„ë“œë°”ì´ ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --toss-black: #191F28;
            --toss-gray-900: #333D4B;
            --toss-gray-700: #4E5968;
            --toss-gray-600: #6B7684;
            --toss-gray-500: #8B95A1;
            --toss-gray-400: #B0B8C1;
            --toss-gray-300: #D1D6DB;
            --toss-gray-200: #E5E8EB;
            --toss-gray-100: #F2F4F6;
            --toss-gray-50: #F9FAFB;
            --toss-white: #FFFFFF;
            --toss-blue: #3182F6;
            --toss-blue-light: #E8F3FF;
            --toss-red: #F04452;
            --toss-red-light: #FFEBEE;
            --toss-green: #30B06E;
            --toss-green-light: #E8F5E9;
            --toss-yellow: #F59F00;
            --toss-yellow-light: #FFF9E6;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Pretendard', sans-serif;
            background: var(--toss-gray-50);
            color: var(--toss-black);
            line-height: 1.5;
        }
        .nav {
            position: fixed; top: 0; left: 0; right: 0; height: 56px;
            background: var(--toss-white);
            border-bottom: 1px solid var(--toss-gray-200);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 24px; z-index: 100;
        }
        .nav-logo { font-size: 18px; font-weight: 700; }
        .nav-logo span { color: var(--toss-blue); }
        .nav-user { display: flex; align-items: center; gap: 16px; }
        .btn-logout {
            font-size: 14px; color: var(--toss-gray-600);
            background: none; border: none; cursor: pointer;
        }
        .btn-logout:hover { color: var(--toss-red); }
        .sidebar {
            position: fixed; top: 56px; left: 0; bottom: 0; width: 240px;
            background: var(--toss-white);
            border-right: 1px solid var(--toss-gray-200);
            padding: 24px 0;
        }
        .sidebar-menu { list-style: none; }
        .sidebar-link {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 24px; font-size: 15px; color: var(--toss-gray-700);
            cursor: pointer; border: none; background: none;
            width: 100%; text-align: left; transition: all 0.15s;
        }
        .sidebar-link:hover { background: var(--toss-gray-100); }
        .sidebar-link.active {
            background: var(--toss-blue-light);
            color: var(--toss-blue); font-weight: 600;
        }
        .main {
            margin-left: 240px; margin-top: 56px;
            min-height: calc(100vh - 56px); padding: 32px;
        }
        .page-header { margin-bottom: 32px; }
        .page-title { font-size: 26px; font-weight: 700; margin-bottom: 8px; }
        .page-desc { font-size: 15px; color: var(--toss-gray-600); }
        .card {
            background: var(--toss-white);
            border-radius: 16px; padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }
        .card-header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 20px;
        }
        .card-title { font-size: 18px; font-weight: 700; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px; margin-bottom: 24px;
        }
        .stat-card {
            background: var(--toss-white);
            border-radius: 16px; padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }
        .stat-label { font-size: 14px; color: var(--toss-gray-600); margin-bottom: 8px; }
        .stat-value { font-size: 28px; font-weight: 700; }
        .stat-value.blue { color: var(--toss-blue); }
        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            padding: 12px 20px; font-size: 15px; font-weight: 600;
            border-radius: 12px; border: none; cursor: pointer; transition: all 0.15s;
        }
        .btn-primary { background: var(--toss-blue); color: white; }
        .btn-primary:hover { background: #2272E6; }
        .btn-primary:disabled { background: var(--toss-gray-300); cursor: not-allowed; }
        .btn-secondary { background: var(--toss-gray-100); color: var(--toss-gray-700); }
        .btn-secondary:hover { background: var(--toss-gray-200); }
        .btn-sm { padding: 8px 16px; font-size: 14px; }
        .btn-danger { background: var(--toss-red-light); color: var(--toss-red); }
        .upload-zone {
            border: 2px dashed var(--toss-gray-300);
            border-radius: 16px; padding: 48px;
            text-align: center; cursor: pointer; transition: all 0.2s;
        }
        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--toss-blue);
            background: var(--toss-blue-light);
        }
        .upload-icon {
            width: 64px; height: 64px; margin: 0 auto 16px;
            background: var(--toss-gray-100); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 28px;
        }
        .upload-title { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
        .upload-desc { font-size: 14px; color: var(--toss-gray-600); }
        .table-wrapper { overflow-x: auto; }
        .table { width: 100%; border-collapse: collapse; }
        .table th {
            text-align: left; padding: 12px 16px;
            font-size: 13px; font-weight: 600; color: var(--toss-gray-600);
            background: var(--toss-gray-50);
            border-bottom: 1px solid var(--toss-gray-200);
        }
        .table td {
            padding: 16px; font-size: 14px;
            border-bottom: 1px solid var(--toss-gray-100);
        }
        .table tr:hover td { background: var(--toss-gray-50); }
        .badge {
            display: inline-flex; padding: 4px 10px;
            font-size: 12px; font-weight: 600; border-radius: 6px;
        }
        .badge-blue { background: var(--toss-blue-light); color: var(--toss-blue); }
        .badge-green { background: var(--toss-green-light); color: var(--toss-green); }
        .badge-red { background: var(--toss-red-light); color: var(--toss-red); }
        .badge-yellow { background: var(--toss-yellow-light); color: var(--toss-yellow); }
        .chart-container { position: relative; height: 300px; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; }
        .form-input {
            width: 100%; padding: 14px 16px; font-size: 15px;
            border: 1px solid var(--toss-gray-300);
            border-radius: 12px; outline: none; transition: all 0.15s;
        }
        .form-input:focus {
            border-color: var(--toss-blue);
            box-shadow: 0 0 0 3px var(--toss-blue-light);
        }
        .form-textarea { min-height: 150px; resize: vertical; font-family: inherit; }
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236B7684' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
        }
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .empty-state { text-align: center; padding: 60px 20px; }
        .empty-icon { font-size: 48px; margin-bottom: 16px; }
        .empty-title { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .empty-desc { font-size: 14px; color: var(--toss-gray-600); }
        .toast {
            position: fixed; bottom: 32px; left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--toss-gray-900); color: white;
            padding: 16px 24px; border-radius: 12px;
            font-size: 15px; font-weight: 500;
            opacity: 0; transition: all 0.3s; z-index: 1000;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .login-container {
            min-height: 100vh; display: flex;
            align-items: center; justify-content: center;
            background: linear-gradient(135deg, #f8fafc 0%, #e8f3ff 100%);
        }
        .login-card {
            background: white; border-radius: 24px;
            padding: 48px; width: 100%; max-width: 400px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
        }
        .login-logo { text-align: center; margin-bottom: 40px; }
        .login-logo h1 { font-size: 28px; font-weight: 700; }
        .login-logo h1 span { color: var(--toss-blue); }
        .login-logo p { color: var(--toss-gray-600); font-size: 14px; margin-top: 8px; }
        .info-box {
            padding: 16px 20px; border-radius: 12px;
            font-size: 14px; line-height: 1.6; margin-bottom: 20px;
        }
        .info-box.blue { background: var(--toss-blue-light); color: var(--toss-blue); }
        .info-box.yellow { background: var(--toss-yellow-light); color: #996600; }
        .info-box.green { background: var(--toss-green-light); color: var(--toss-green); }
        .progress-bar {
            height: 8px; background: var(--toss-gray-100);
            border-radius: 4px; overflow: hidden;
        }
        .progress-fill {
            height: 100%; background: var(--toss-blue);
            border-radius: 4px; transition: width 0.3s;
        }
        .chip {
            display: inline-flex; padding: 8px 16px;
            font-size: 14px; font-weight: 500;
            background: var(--toss-gray-100);
            border: none; border-radius: 20px;
            cursor: pointer; transition: all 0.15s;
        }
        .chip:hover { background: var(--toss-gray-200); }
        .chip.active { background: var(--toss-blue); color: white; }
        .data-row {
            display: flex; justify-content: space-between;
            padding: 16px 0; border-bottom: 1px solid var(--toss-gray-100);
        }
        .data-row:last-child { border-bottom: none; }
        .data-label { color: var(--toss-gray-600); }
        .data-value { font-weight: 600; }
        @media (max-width: 1024px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main { margin-left: 0; }
            .stats-grid { grid-template-columns: 1fr; }
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <div id="toast" class="toast"></div>

    <script>
        // ============================================
        // ìƒíƒœ ê´€ë¦¬
        // ============================================
        const state = {
            isLoggedIn: localStorage.getItem('bidbuy_logged_in') === 'true',
            currentPage: 'dashboard',
            salesData: JSON.parse(localStorage.getItem('bidbuy_sales') || '[]'),
            trendData: JSON.parse(localStorage.getItem('bidbuy_trends') || '[]'),
            newsletters: JSON.parse(localStorage.getItem('bidbuy_newsletters') || '[]'),
            subscribers: JSON.parse(localStorage.getItem('bidbuy_subscribers') || '[]'),
            geminiApiKey: localStorage.getItem('bidbuy_gemini_key') || '',
            showApiKey: false,
            isGenerating: false,
            generatedContent: '',
            weekInfo: { month: new Date().getMonth() + 1, week: Math.ceil(new Date().getDate() / 7) },
            charts: {}
        };

        // ìƒ˜í”Œ ë°ì´í„° ì´ˆê¸°í™”
        if (state.trendData.length === 0) {
            state.trendData = [
                { id: 1, keyword: 'ë¯¸ì¦ˆë…¸ ê¸€ëŸ¬ë¸Œ', category: 'ì•¼êµ¬ìš©í’ˆ', searches: 347, change: 23, price: 15000 },
                { id: 2, keyword: 'ì›í”¼ìŠ¤ í”¼ê·œì–´', category: 'í”¼ê·œì–´', searches: 282, change: 45, price: 8500 },
                { id: 3, keyword: 'ì•„ì‹ìŠ¤ ë°°íŠ¸', category: 'ì•¼êµ¬ìš©í’ˆ', searches: 269, change: 12, price: 25000 },
                { id: 4, keyword: 'ê±´ë‹´ í”„ë¼ëª¨ë¸', category: 'í”¼ê·œì–´', searches: 228, change: 8, price: 4500 },
                { id: 5, keyword: 'í¬ì¼“ëª¬ ì¹´ë“œ', category: 'ì™„êµ¬', searches: 217, change: 31, price: 3000 },
            ];
            saveState();
        }

        if (state.subscribers.length === 0) {
            state.subscribers = [
                { id: 1, email: 'user1@example.com', name: 'ê¹€ì² ìˆ˜', subscribed: true, createdAt: '2024-11-01' },
                { id: 2, email: 'user2@example.com', name: 'ì´ì˜í¬', subscribed: true, createdAt: '2024-11-15' },
            ];
            saveState();
        }

        // ============================================
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        // ============================================
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function formatNumber(n) {
            return new Intl.NumberFormat('ko-KR').format(n || 0);
        }

        function formatCurrency(n) {
            return new Intl.NumberFormat('ko-KR').format(n || 0) + 'ì›';
        }

        function saveState() {
            localStorage.setItem('bidbuy_sales', JSON.stringify(state.salesData));
            localStorage.setItem('bidbuy_trends', JSON.stringify(state.trendData));
            localStorage.setItem('bidbuy_newsletters', JSON.stringify(state.newsletters));
            localStorage.setItem('bidbuy_subscribers', JSON.stringify(state.subscribers));
        }

        function destroyCharts() {
            Object.values(state.charts).forEach(chart => {
                if (chart) chart.destroy();
            });
            state.charts = {};
        }

        // ============================================
        // ì—‘ì…€ íŒŒì‹±
        // ============================================
        async function parseExcel(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const sheet = workbook.Sheets[workbook.SheetNames[0]];
                        const json = XLSX.utils.sheet_to_json(sheet);
                        resolve(json);
                    } catch (err) {
                        reject(err);
                    }
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        // ============================================
        // ì¹´í…Œê³ ë¦¬ ë¶„ì„
        // ============================================
        function analyzeCategories() {
            const stats = {};
            let totalSales = 0, totalQty = 0;

            state.salesData.forEach(item => {
                const cat = item['ì¹´í…Œê³ ë¦¬'] || item.category || item.Category || 'ê¸°íƒ€';
                const sales = parseFloat(item['íŒë§¤ê¸ˆì•¡'] || item.sales || item.Sales || item['ê¸ˆì•¡'] || 0);
                const qty = parseInt(item['íŒë§¤ìˆ˜ëŸ‰'] || item.quantity || item.Quantity || item['ìˆ˜ëŸ‰'] || 1);

                if (!stats[cat]) stats[cat] = { sales: 0, quantity: 0, count: 0 };
                stats[cat].sales += sales;
                stats[cat].quantity += qty;
                stats[cat].count++;
                totalSales += sales;
                totalQty += qty;
            });

            Object.keys(stats).forEach(cat => {
                stats[cat].ratio = totalSales > 0 ? (stats[cat].sales / totalSales * 100).toFixed(1) : 0;
            });

            return { stats, totalSales, totalQty };
        }

        // ============================================
        // Gemini API
        // ============================================
        async function callGemini(prompt) {
            if (!state.geminiApiKey) {
                showToast('API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”');
                return null;
            }

            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${state.geminiApiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { temperature: 0.8, maxOutputTokens: 2048 }
                })
            });

            const data = await res.json();
            if (data.candidates?.[0]) {
                return data.candidates[0].content.parts[0].text;
            }
            throw new Error(data.error?.message || 'API ì˜¤ë¥˜');
        }

        // ============================================
        // ë Œë”ë§
        // ============================================
        function render() {
            destroyCharts();
            const app = document.getElementById('app');
            app.innerHTML = state.isLoggedIn ? renderApp() : renderLogin();
            attachEvents();

            // ì°¨íŠ¸ ë Œë”ë§
            setTimeout(() => {
                if (state.currentPage === 'dashboard') renderDashboardCharts();
                if (state.currentPage === 'analysis') renderAnalysisCharts();
            }, 100);
        }

        function renderLogin() {
            return `
            <div class="login-container">
                <div class="login-card">
                    <div class="login-logo">
                        <h1>ë¹„ë“œë°”ì´<span>ì½”ë¦¬ì•„</span></h1>
                        <p>íŒë§¤ ë¶„ì„ & ë‰´ìŠ¤ë ˆí„° ì‹œìŠ¤í…œ</p>
                    </div>
                    <form id="loginForm">
                        <div class="form-group">
                            <label class="form-label">ì•„ì´ë””</label>
                            <input type="text" id="loginId" class="form-input" placeholder="admin" autocomplete="off">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="loginPw" class="form-input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" autocomplete="new-password">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width:100%;margin-top:8px;">ë¡œê·¸ì¸</button>
                    </form>
                    <p style="text-align:center;margin-top:20px;font-size:13px;color:var(--toss-gray-500);">
                        í…ŒìŠ¤íŠ¸ ê³„ì •: admin / admin123
                    </p>
                </div>
            </div>`;
        }

        function renderApp() {
            const menuItems = [
                { id: 'dashboard', icon: 'ğŸ“Š', label: 'ëŒ€ì‹œë³´ë“œ' },
                { id: 'upload', icon: 'ğŸ“¤', label: 'ë°ì´í„° ì—…ë¡œë“œ' },
                { id: 'analysis', icon: 'ğŸ“ˆ', label: 'íŒë§¤ ë¶„ì„' },
                { id: 'trends', icon: 'ğŸ”¥', label: 'íŠ¸ë Œë“œ ê´€ë¦¬' },
                { id: 'newsletter', icon: 'âœ‰ï¸', label: 'ë‰´ìŠ¤ë ˆí„°' },
                { id: 'subscribers', icon: 'ğŸ‘¥', label: 'êµ¬ë…ì ê´€ë¦¬' },
                { id: 'settings', icon: 'âš™ï¸', label: 'ì„¤ì •' },
            ];

            return `
            <nav class="nav">
                <div class="nav-logo">ë¹„ë“œë°”ì´<span>ì• ë„ë¦¬í‹±ìŠ¤</span></div>
                <div class="nav-user">
                    <span style="font-size:14px;color:var(--toss-gray-700);">ê´€ë¦¬ìë‹˜</span>
                    <button class="btn-logout" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </nav>
            <aside class="sidebar">
                <ul class="sidebar-menu">
                    ${menuItems.map(m => `
                        <li><button class="sidebar-link ${state.currentPage === m.id ? 'active' : ''}" data-page="${m.id}">
                            <span>${m.icon}</span> ${m.label}
                        </button></li>
                    `).join('')}
                </ul>
            </aside>
            <main class="main">${renderPage()}</main>`;
        }

        function renderPage() {
            switch(state.currentPage) {
                case 'dashboard': return renderDashboard();
                case 'upload': return renderUpload();
                case 'analysis': return renderAnalysis();
                case 'trends': return renderTrends();
                case 'newsletter': return renderNewsletter();
                case 'subscribers': return renderSubscribers();
                case 'settings': return renderSettings();
                default: return renderDashboard();
            }
        }

        // ============================================
        // ëŒ€ì‹œë³´ë“œ
        // ============================================
        function renderDashboard() {
            const { stats, totalSales, totalQty } = analyzeCategories();
            const catCount = Object.keys(stats).length;
            const activeSubscribers = state.subscribers.filter(s => s.subscribed).length;

            return `
            <div class="page-header">
                <h1 class="page-title">ëŒ€ì‹œë³´ë“œ</h1>
                <p class="page-desc">${state.weekInfo.month}ì›” ${state.weekInfo.week}ì£¼ì°¨ í˜„í™©</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ì´ íŒë§¤ê¸ˆì•¡</div>
                    <div class="stat-value blue">${formatCurrency(totalSales)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì´ íŒë§¤ìˆ˜ëŸ‰</div>
                    <div class="stat-value">${formatNumber(totalQty)}ê°œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì¹´í…Œê³ ë¦¬</div>
                    <div class="stat-value">${catCount}ê°œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">êµ¬ë…ì</div>
                    <div class="stat-value">${activeSubscribers}ëª…</div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><h3 class="card-title">ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤</h3></div>
                    <div class="chart-container"><canvas id="catChart"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3 class="card-title">TOP 5 íŠ¸ë Œë“œ</h3></div>
                    ${state.trendData.length > 0 ? `
                    <div>
                        ${state.trendData.slice(0, 5).map((t, i) => `
                        <div class="data-row">
                            <div>
                                <span class="badge ${i < 3 ? 'badge-red' : 'badge-blue'}" style="margin-right:8px;">${i + 1}</span>
                                <strong>${t.keyword}</strong>
                                <span style="color:var(--toss-gray-500);margin-left:8px;">${t.category}</span>
                            </div>
                            <div>
                                <span style="color:var(--toss-blue);">${formatNumber(t.searches)}ê±´</span>
                                <span class="badge ${t.change >= 0 ? 'badge-red' : 'badge-green'}" style="margin-left:8px;">
                                    ${t.change >= 0 ? 'â†‘' : 'â†“'}${Math.abs(t.change)}%
                                </span>
                            </div>
                        </div>
                        `).join('')}
                    </div>
                    ` : '<div class="empty-state"><div class="empty-icon">ğŸ“Š</div><div class="empty-title">íŠ¸ë Œë“œ ë°ì´í„° ì—†ìŒ</div></div>'}
                </div>
            </div>`;
        }

        function renderDashboardCharts() {
            const { stats } = analyzeCategories();
            const cats = Object.keys(stats);
            const ctx = document.getElementById('catChart');

            if (ctx && cats.length > 0) {
                state.charts.cat = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: cats,
                        datasets: [{
                            data: cats.map(c => stats[c].sales),
                            backgroundColor: ['#3182F6', '#F04452', '#30B06E', '#F59F00', '#8B95A1', '#6B7684'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'bottom' } }
                    }
                });
            }
        }

        // ============================================
        // ë°ì´í„° ì—…ë¡œë“œ
        // ============================================
        function renderUpload() {
            return `
            <div class="page-header">
                <h1 class="page-title">ë°ì´í„° ì—…ë¡œë“œ</h1>
                <p class="page-desc">ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ íŒë§¤ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì„¸ìš”</p>
            </div>

            <div class="card">
                <div class="upload-zone" id="uploadZone">
                    <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" style="display:none;">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-title">ì—‘ì…€ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</div>
                    <div class="upload-desc">ì§€ì› í˜•ì‹: .xlsx, .xls, .csv</div>
                </div>
            </div>

            ${state.salesData.length > 0 ? `
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ì—…ë¡œë“œëœ ë°ì´í„° (${state.salesData.length}ê±´)</h3>
                    <div style="display:flex;gap:8px;">
                        <button class="btn btn-primary" id="analyzeBtn">ğŸ“ˆ ë°ì´í„° ë¶„ì„í•˜ê¸°</button>
                        <button class="btn btn-danger btn-sm" id="clearDataBtn">ì‚­ì œ</button>
                    </div>
                </div>
                <div class="info-box green">
                    âœ… ${state.salesData.length}ê±´ì˜ ë°ì´í„°ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. "ë°ì´í„° ë¶„ì„í•˜ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.
                </div>
                <div class="table-wrapper" style="max-height:400px;overflow-y:auto;margin-top:16px;">
                    <table class="table">
                        <thead>
                            <tr>${Object.keys(state.salesData[0]).slice(0, 6).map(k => `<th>${k}</th>`).join('')}</tr>
                        </thead>
                        <tbody>
                            ${state.salesData.slice(0, 20).map(row => `
                            <tr>${Object.values(row).slice(0, 6).map(v => `<td>${v}</td>`).join('')}</tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ${state.salesData.length > 20 ? `<p style="text-align:center;color:var(--toss-gray-500);padding:16px;">... ì™¸ ${state.salesData.length - 20}ê±´</p>` : ''}
            </div>
            ` : `
            <div class="card">
                <div class="card-header"><h3 class="card-title">ë°ì´í„° í˜•ì‹ ì•ˆë‚´</h3></div>
                <p style="color:var(--toss-gray-600);margin-bottom:16px;">ì—‘ì…€ íŒŒì¼ì— ë‹¤ìŒ ì—´ì´ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:</p>
                <table class="table">
                    <thead><tr><th>ì—´ ì´ë¦„</th><th>ì„¤ëª…</th><th>í•„ìˆ˜</th></tr></thead>
                    <tbody>
                        <tr><td><code>ì¹´í…Œê³ ë¦¬</code></td><td>ìƒí’ˆ ì¹´í…Œê³ ë¦¬</td><td><span class="badge badge-red">í•„ìˆ˜</span></td></tr>
                        <tr><td><code>íŒë§¤ê¸ˆì•¡</code></td><td>íŒë§¤ ê¸ˆì•¡</td><td><span class="badge badge-red">í•„ìˆ˜</span></td></tr>
                        <tr><td><code>íŒë§¤ìˆ˜ëŸ‰</code></td><td>íŒë§¤ ìˆ˜ëŸ‰</td><td><span class="badge badge-blue">ì„ íƒ</span></td></tr>
                    </tbody>
                </table>
            </div>
            `}`;
        }

        // ============================================
        // íŒë§¤ ë¶„ì„
        // ============================================
        function renderAnalysis() {
            if (state.salesData.length === 0) {
                return `
                <div class="page-header">
                    <h1 class="page-title">íŒë§¤ ë¶„ì„</h1>
                    <p class="page-desc">ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ í˜„í™©ì„ ë¶„ì„í•©ë‹ˆë‹¤</p>
                </div>
                <div class="card">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“Š</div>
                        <div class="empty-title">ë¶„ì„í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="empty-desc">ë°ì´í„° ì—…ë¡œë“œ í˜ì´ì§€ì—ì„œ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</div>
                        <button class="btn btn-primary" style="margin-top:20px;" data-page="upload">ë°ì´í„° ì—…ë¡œë“œí•˜ê¸°</button>
                    </div>
                </div>`;
            }

            const { stats, totalSales, totalQty } = analyzeCategories();
            const sortedCats = Object.entries(stats).sort((a, b) => b[1].sales - a[1].sales);

            return `
            <div class="page-header">
                <h1 class="page-title">íŒë§¤ ë¶„ì„</h1>
                <p class="page-desc">ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ í˜„í™©</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">ì´ íŒë§¤ê¸ˆì•¡</div>
                    <div class="stat-value blue">${formatCurrency(totalSales)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì´ íŒë§¤ìˆ˜ëŸ‰</div>
                    <div class="stat-value">${formatNumber(totalQty)}ê°œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">í‰ê·  ê°ë‹¨ê°€</div>
                    <div class="stat-value">${formatCurrency(totalQty > 0 ? Math.round(totalSales / totalQty) : 0)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ì¹´í…Œê³ ë¦¬ ìˆ˜</div>
                    <div class="stat-value">${sortedCats.length}ê°œ</div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><h3 class="card-title">ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ê¸ˆì•¡</h3></div>
                    <div class="chart-container"><canvas id="salesPieChart"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3 class="card-title">ì¹´í…Œê³ ë¦¬ë³„ íŒë§¤ìˆ˜ëŸ‰</h3></div>
                    <div class="chart-container"><canvas id="qtyBarChart"></canvas></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h3 class="card-title">ì¹´í…Œê³ ë¦¬ë³„ ìƒì„¸</h3></div>
                <table class="table">
                    <thead><tr><th>ìˆœìœ„</th><th>ì¹´í…Œê³ ë¦¬</th><th>íŒë§¤ê¸ˆì•¡</th><th>ë¹„ì¤‘</th><th>íŒë§¤ìˆ˜ëŸ‰</th></tr></thead>
                    <tbody>
                        ${sortedCats.map(([cat, data], i) => `
                        <tr>
                            <td><span class="badge ${i < 3 ? 'badge-red' : 'badge-blue'}">${i + 1}</span></td>
                            <td><strong>${cat}</strong></td>
                            <td>${formatCurrency(data.sales)}</td>
                            <td>
                                <div style="display:flex;align-items:center;gap:8px;">
                                    <div class="progress-bar" style="flex:1;"><div class="progress-fill" style="width:${data.ratio}%;"></div></div>
                                    <span style="min-width:45px;">${data.ratio}%</span>
                                </div>
                            </td>
                            <td>${formatNumber(data.quantity)}ê°œ</td>
                        </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>`;
        }

        function renderAnalysisCharts() {
            const { stats } = analyzeCategories();
            const cats = Object.keys(stats);

            const pieCtx = document.getElementById('salesPieChart');
            if (pieCtx && cats.length > 0) {
                state.charts.pie = new Chart(pieCtx, {
                    type: 'pie',
                    data: {
                        labels: cats,
                        datasets: [{
                            data: cats.map(c => stats[c].sales),
                            backgroundColor: ['#3182F6', '#F04452', '#30B06E', '#F59F00', '#8B95A1', '#6B7684'],
                            borderWidth: 0
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
                });
            }

            const barCtx = document.getElementById('qtyBarChart');
            if (barCtx && cats.length > 0) {
                state.charts.bar = new Chart(barCtx, {
                    type: 'bar',
                    data: {
                        labels: cats,
                        datasets: [{
                            label: 'íŒë§¤ìˆ˜ëŸ‰',
                            data: cats.map(c => stats[c].quantity),
                            backgroundColor: '#3182F6',
                            borderRadius: 8
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
                });
            }
        }

        // ============================================
        // íŠ¸ë Œë“œ ê´€ë¦¬
        // ============================================
        function renderTrends() {
            return `
            <div class="page-header">
                <h1 class="page-title">íŠ¸ë Œë“œ ê´€ë¦¬</h1>
                <p class="page-desc">ì¸ê¸° ê²€ìƒ‰ í‚¤ì›Œë“œë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">íŠ¸ë Œë“œ í‚¤ì›Œë“œ (${state.trendData.length}ê°œ)</h3>
                    <button class="btn btn-primary btn-sm" id="addTrendBtn">+ ì¶”ê°€</button>
                </div>

                ${state.trendData.length > 0 ? `
                <table class="table">
                    <thead><tr><th>ìˆœìœ„</th><th>í‚¤ì›Œë“œ</th><th>ì¹´í…Œê³ ë¦¬</th><th>ê²€ìƒ‰ëŸ‰</th><th>ë³€í™”ìœ¨</th><th>ê´€ë¦¬</th></tr></thead>
                    <tbody>
                        ${state.trendData.map((t, i) => `
                        <tr>
                            <td><span class="badge ${i < 3 ? 'badge-red' : 'badge-blue'}">${i + 1}</span></td>
                            <td><strong>${t.keyword}</strong></td>
                            <td>${t.category}</td>
                            <td>${formatNumber(t.searches)}ê±´</td>
                            <td><span class="badge ${t.change >= 0 ? 'badge-red' : 'badge-green'}">${t.change >= 0 ? 'â†‘' : 'â†“'}${Math.abs(t.change)}%</span></td>
                            <td>
                                <button class="btn btn-secondary btn-sm edit-trend" data-id="${t.id}">ìˆ˜ì •</button>
                                <button class="btn btn-danger btn-sm delete-trend" data-id="${t.id}">ì‚­ì œ</button>
                            </td>
                        </tr>
                        `).join('')}
                    </tbody>
                </table>
                ` : '<div class="empty-state"><div class="empty-icon">ğŸ”¥</div><div class="empty-title">íŠ¸ë Œë“œ ë°ì´í„° ì—†ìŒ</div></div>'}
            </div>`;
        }

        // ============================================
        // ë‰´ìŠ¤ë ˆí„°
        // ============================================
        function renderNewsletter() {
            const hasApiKey = state.geminiApiKey.length > 10;

            return `
            <div class="page-header">
                <h1 class="page-title">ë‰´ìŠ¤ë ˆí„°</h1>
                <p class="page-desc">AIë¡œ ë‰´ìŠ¤ë ˆí„° ì½˜í…ì¸ ë¥¼ ìƒì„±í•©ë‹ˆë‹¤</p>
            </div>

            ${!hasApiKey ? `
            <div class="info-box yellow">
                âš ï¸ AI ì½˜í…ì¸  ìƒì„±ì„ ìœ„í•´ <button style="color:var(--toss-blue);background:none;border:none;cursor:pointer;text-decoration:underline;" data-page="settings">ì„¤ì •</button>ì—ì„œ Gemini API í‚¤ë¥¼ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.
            </div>
            ` : ''}

            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><h3 class="card-title">AI ì½˜í…ì¸  ìƒì„±</h3></div>
                    <div class="form-group">
                        <label class="form-label">ì½˜í…ì¸  ìœ í˜•</label>
                        <select id="contentType" class="form-input form-select">
                            <option value="newsletter">ğŸ“§ ë‰´ìŠ¤ë ˆí„°</option>
                            <option value="blog">ğŸ“ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸</option>
                            <option value="sns">ğŸ“± SNS í¬ìŠ¤íŠ¸</option>
                        </select>
                    </div>
                    <div class="info-box blue">
                        ğŸ’¡ ${state.trendData.length}ê°œ íŠ¸ë Œë“œ í‚¤ì›Œë“œ ê¸°ë°˜ìœ¼ë¡œ ì½˜í…ì¸ ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                    </div>
                    <button class="btn btn-primary" style="width:100%;" id="generateBtn" ${!hasApiKey ? 'disabled' : ''}>
                        ${state.isGenerating ? 'â³ ìƒì„± ì¤‘...' : 'âœ¨ AI ì½˜í…ì¸  ìƒì„±'}
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">ìƒì„±ëœ ì½˜í…ì¸ </h3>
                        <button class="btn btn-secondary btn-sm" id="copyContentBtn">ğŸ“‹ ë³µì‚¬</button>
                    </div>
                    <div style="background:var(--toss-gray-900);border-radius:12px;padding:20px;min-height:300px;">
                        <pre id="generatedContent" style="color:white;font-size:14px;white-space:pre-wrap;line-height:1.8;font-family:inherit;">${state.generatedContent || 'ì™¼ìª½ì—ì„œ ì½˜í…ì¸  ìœ í˜•ì„ ì„ íƒí•˜ê³ \n"AI ì½˜í…ì¸  ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.'}</pre>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h3 class="card-title">ë°œì†¡ ë‚´ì—­</h3></div>
                ${state.newsletters.length > 0 ? `
                <table class="table">
                    <thead><tr><th>ì œëª©</th><th>ë°œì†¡ì¼</th><th>ìˆ˜ì‹ ì</th><th>ìƒíƒœ</th></tr></thead>
                    <tbody>
                        ${state.newsletters.map(n => `
                        <tr>
                            <td><strong>${n.title}</strong></td>
                            <td>${n.sentAt}</td>
                            <td>${n.recipients}ëª…</td>
                            <td><span class="badge badge-green">ë°œì†¡ì™„ë£Œ</span></td>
                        </tr>
                        `).join('')}
                    </tbody>
                </table>
                ` : '<div class="empty-state"><div class="empty-icon">âœ‰ï¸</div><div class="empty-title">ë°œì†¡ ë‚´ì—­ ì—†ìŒ</div></div>'}
            </div>`;
        }

        // ============================================
        // êµ¬ë…ì ê´€ë¦¬
        // ============================================
        function renderSubscribers() {
            const active = state.subscribers.filter(s => s.subscribed).length;
            const inactive = state.subscribers.length - active;

            return `
            <div class="page-header">
                <h1 class="page-title">êµ¬ë…ì ê´€ë¦¬</h1>
                <p class="page-desc">ë‰´ìŠ¤ë ˆí„° êµ¬ë…ìë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
            </div>

            <div class="grid-3">
                <div class="stat-card">
                    <div class="stat-label">ì „ì²´ êµ¬ë…ì</div>
                    <div class="stat-value">${state.subscribers.length}ëª…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">í™œì„± êµ¬ë…ì</div>
                    <div class="stat-value" style="color:var(--toss-green);">${active}ëª…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">êµ¬ë… í•´ì§€</div>
                    <div class="stat-value" style="color:var(--toss-red);">${inactive}ëª…</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">êµ¬ë…ì ëª©ë¡</h3>
                    <button class="btn btn-primary btn-sm" id="addSubscriberBtn">+ ì¶”ê°€</button>
                </div>

                ${state.subscribers.length > 0 ? `
                <table class="table">
                    <thead><tr><th>ì´ë¦„</th><th>ì´ë©”ì¼</th><th>ê°€ì…ì¼</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead>
                    <tbody>
                        ${state.subscribers.map(s => `
                        <tr>
                            <td><strong>${s.name}</strong></td>
                            <td>${s.email}</td>
                            <td>${s.createdAt}</td>
                            <td><span class="badge ${s.subscribed ? 'badge-green' : 'badge-red'}">${s.subscribed ? 'êµ¬ë…ì¤‘' : 'í•´ì§€'}</span></td>
                            <td>
                                <button class="btn btn-secondary btn-sm toggle-sub" data-id="${s.id}">${s.subscribed ? 'í•´ì§€' : 'ì¬êµ¬ë…'}</button>
                                <button class="btn btn-danger btn-sm delete-sub" data-id="${s.id}">ì‚­ì œ</button>
                            </td>
                        </tr>
                        `).join('')}
                    </tbody>
                </table>
                ` : '<div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><div class="empty-title">êµ¬ë…ì ì—†ìŒ</div></div>'}
            </div>`;
        }

        // ============================================
        // ì„¤ì •
        // ============================================
        function renderSettings() {
            const hasApiKey = state.geminiApiKey.length > 10;

            return `
            <div class="page-header">
                <h1 class="page-title">ì„¤ì •</h1>
                <p class="page-desc">ì‹œìŠ¤í…œ ì„¤ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
            </div>

            <div class="card" style="max-width:640px;">
                <div class="card-header">
                    <h3 class="card-title">ğŸ¤– Gemini AI ì„¤ì •</h3>
                    <span class="badge ${hasApiKey ? 'badge-green' : 'badge-red'}">${hasApiKey ? 'ì—°ê²°ë¨' : 'ë¯¸ì—°ê²°'}</span>
                </div>

                <div class="info-box blue">
                    <strong>AI ì½˜í…ì¸  ìƒì„±</strong>ì„ ì‚¬ìš©í•˜ë ¤ë©´ Google Gemini API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.
                </div>

                <div class="form-group">
                    <label class="form-label">Gemini API í‚¤</label>
                    <div style="display:flex;gap:8px;">
                        <input type="${state.showApiKey ? 'text' : 'password'}" id="apiKeyInput" class="form-input"
                               value="${state.geminiApiKey}" placeholder="AIzaSy..." style="flex:1;">
                        <button class="btn btn-secondary" id="toggleKeyBtn">${state.showApiKey ? 'ìˆ¨ê¸°ê¸°' : 'ë³´ê¸°'}</button>
                    </div>
                </div>

                <div style="display:flex;gap:12px;margin-bottom:20px;">
                    <button class="btn btn-primary" id="saveApiKeyBtn" style="flex:1;">ğŸ’¾ ì €ì¥</button>
                    <button class="btn btn-secondary" id="testApiKeyBtn" style="flex:1;">ğŸ” ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                </div>

                <div style="background:var(--toss-gray-50);padding:16px;border-radius:12px;">
                    <p style="font-weight:600;margin-bottom:12px;">ğŸ“‹ API í‚¤ ë°œê¸‰ ë°©ë²•</p>
                    <ol style="font-size:14px;color:var(--toss-gray-600);line-height:2;padding-left:20px;">
                        <li><a href="https://aistudio.google.com/app/apikey" target="_blank" style="color:var(--toss-blue);">Google AI Studio</a> ì ‘ì†</li>
                        <li>Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</li>
                        <li>"Create API Key" ë²„íŠ¼ í´ë¦­</li>
                        <li>ìƒì„±ëœ API í‚¤ë¥¼ ìœ„ì— ë¶™ì—¬ë„£ê¸°</li>
                    </ol>
                </div>
            </div>

            <div class="card" style="max-width:640px;">
                <div class="card-header"><h3 class="card-title">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3></div>
                <div style="display:flex;gap:12px;">
                    <button class="btn btn-secondary" id="exportBtn" style="flex:1;">ğŸ“¥ ë°±ì—… ë‹¤ìš´ë¡œë“œ</button>
                    <button class="btn btn-danger" id="resetBtn" style="flex:1;">ğŸ—‘ï¸ ì „ì²´ ì´ˆê¸°í™”</button>
                </div>
            </div>`;
        }

        // ============================================
        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        // ============================================
        function attachEvents() {
            // ë¡œê·¸ì¸
            document.getElementById('loginForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = document.getElementById('loginId').value;
                const pw = document.getElementById('loginPw').value;
                if (id === 'admin' && pw === 'admin123') {
                    state.isLoggedIn = true;
                    localStorage.setItem('bidbuy_logged_in', 'true');
                    render();
                    showToast('ë¡œê·¸ì¸ ì„±ê³µ');
                } else {
                    showToast('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤');
                }
            });

            // ë¡œê·¸ì•„ì›ƒ
            document.getElementById('logoutBtn')?.addEventListener('click', () => {
                state.isLoggedIn = false;
                localStorage.setItem('bidbuy_logged_in', 'false');
                render();
            });

            // ë„¤ë¹„ê²Œì´ì…˜
            document.querySelectorAll('[data-page]').forEach(el => {
                el.addEventListener('click', () => {
                    state.currentPage = el.dataset.page;
                    render();
                });
            });

            // íŒŒì¼ ì—…ë¡œë“œ
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');

            if (uploadZone && fileInput) {
                uploadZone.addEventListener('click', () => fileInput.click());
                uploadZone.addEventListener('dragover', (e) => { e.preventDefault(); uploadZone.classList.add('dragover'); });
                uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('dragover'));
                uploadZone.addEventListener('drop', async (e) => {
                    e.preventDefault();
                    uploadZone.classList.remove('dragover');
                    const file = e.dataTransfer.files[0];
                    if (file) await handleFileUpload(file);
                });
                fileInput.addEventListener('change', async (e) => {
                    if (e.target.files[0]) await handleFileUpload(e.target.files[0]);
                });
            }

            // ë°ì´í„° ë¶„ì„ ë²„íŠ¼
            document.getElementById('analyzeBtn')?.addEventListener('click', () => {
                state.currentPage = 'analysis';
                render();
                showToast('ë¶„ì„ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤');
            });

            // ë°ì´í„° ì‚­ì œ
            document.getElementById('clearDataBtn')?.addEventListener('click', () => {
                if (confirm('ì—…ë¡œë“œëœ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    state.salesData = [];
                    saveState();
                    render();
                    showToast('ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            });

            // íŠ¸ë Œë“œ ì¶”ê°€
            document.getElementById('addTrendBtn')?.addEventListener('click', () => {
                const keyword = prompt('í‚¤ì›Œë“œ:');
                if (keyword) {
                    const newId = Math.max(0, ...state.trendData.map(t => t.id)) + 1;
                    state.trendData.push({
                        id: newId,
                        keyword,
                        category: prompt('ì¹´í…Œê³ ë¦¬:') || 'ê¸°íƒ€',
                        searches: parseInt(prompt('ê²€ìƒ‰ëŸ‰:')) || 0,
                        change: parseInt(prompt('ë³€í™”ìœ¨(%):')) || 0,
                        price: parseInt(prompt('ê°€ê²©(ì—”):')) || 0
                    });
                    saveState();
                    render();
                    showToast('íŠ¸ë Œë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            });

            // íŠ¸ë Œë“œ ì‚­ì œ
            document.querySelectorAll('.delete-trend').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        state.trendData = state.trendData.filter(t => t.id !== parseInt(btn.dataset.id));
                        saveState();
                        render();
                        showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                    }
                });
            });

            // íŠ¸ë Œë“œ ìˆ˜ì •
            document.querySelectorAll('.edit-trend').forEach(btn => {
                btn.addEventListener('click', () => {
                    const t = state.trendData.find(x => x.id === parseInt(btn.dataset.id));
                    if (t) {
                        t.keyword = prompt('í‚¤ì›Œë“œ:', t.keyword) || t.keyword;
                        t.category = prompt('ì¹´í…Œê³ ë¦¬:', t.category) || t.category;
                        t.searches = parseInt(prompt('ê²€ìƒ‰ëŸ‰:', t.searches)) || t.searches;
                        t.change = parseInt(prompt('ë³€í™”ìœ¨(%):', t.change)) ?? t.change;
                        saveState();
                        render();
                        showToast('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
                    }
                });
            });

            // AI ì½˜í…ì¸  ìƒì„±
            document.getElementById('generateBtn')?.addEventListener('click', async () => {
                state.isGenerating = true;
                render();

                try {
                    const type = document.getElementById('contentType')?.value || 'newsletter';
                    const prompt = buildPrompt(type);
                    const content = await callGemini(prompt);
                    state.generatedContent = content || 'ìƒì„± ì‹¤íŒ¨';
                } catch (err) {
                    state.generatedContent = 'ì˜¤ë¥˜: ' + err.message;
                }

                state.isGenerating = false;
                render();
            });

            // ì½˜í…ì¸  ë³µì‚¬
            document.getElementById('copyContentBtn')?.addEventListener('click', () => {
                if (state.generatedContent) {
                    navigator.clipboard.writeText(state.generatedContent);
                    showToast('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            });

            // êµ¬ë…ì ì¶”ê°€
            document.getElementById('addSubscriberBtn')?.addEventListener('click', () => {
                const email = prompt('ì´ë©”ì¼:');
                if (email) {
                    const newId = Math.max(0, ...state.subscribers.map(s => s.id)) + 1;
                    state.subscribers.push({
                        id: newId,
                        email,
                        name: prompt('ì´ë¦„:') || 'ìµëª…',
                        subscribed: true,
                        createdAt: new Date().toISOString().split('T')[0]
                    });
                    saveState();
                    render();
                    showToast('êµ¬ë…ìê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
                }
            });

            // êµ¬ë…ì í† ê¸€
            document.querySelectorAll('.toggle-sub').forEach(btn => {
                btn.addEventListener('click', () => {
                    const s = state.subscribers.find(x => x.id === parseInt(btn.dataset.id));
                    if (s) {
                        s.subscribed = !s.subscribed;
                        saveState();
                        render();
                    }
                });
            });

            // êµ¬ë…ì ì‚­ì œ
            document.querySelectorAll('.delete-sub').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        state.subscribers = state.subscribers.filter(s => s.id !== parseInt(btn.dataset.id));
                        saveState();
                        render();
                        showToast('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                    }
                });
            });

            // API í‚¤ ì €ì¥
            document.getElementById('saveApiKeyBtn')?.addEventListener('click', () => {
                state.geminiApiKey = document.getElementById('apiKeyInput').value;
                localStorage.setItem('bidbuy_gemini_key', state.geminiApiKey);
                showToast('API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
                render();
            });

            // API í‚¤ í† ê¸€
            document.getElementById('toggleKeyBtn')?.addEventListener('click', () => {
                state.showApiKey = !state.showApiKey;
                render();
            });

            // API í…ŒìŠ¤íŠ¸
            document.getElementById('testApiKeyBtn')?.addEventListener('click', async () => {
                const key = document.getElementById('apiKeyInput').value;
                if (!key) { showToast('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }

                showToast('ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...');
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: 'í…ŒìŠ¤íŠ¸' }] }], generationConfig: { maxOutputTokens: 10 } })
                    });
                    const data = await res.json();

                    if (data.candidates) {
                        showToast('âœ… ì—°ê²° ì„±ê³µ!');
                        state.geminiApiKey = key;
                        localStorage.setItem('bidbuy_gemini_key', key);
                        render();
                    } else {
                        showToast('âŒ ì˜¤ë¥˜: ' + (data.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    }
                } catch (err) {
                    showToast('âŒ ì—°ê²° ì‹¤íŒ¨: ' + err.message);
                }
            });

            // ë°±ì—…
            document.getElementById('exportBtn')?.addEventListener('click', () => {
                const data = { salesData: state.salesData, trendData: state.trendData, newsletters: state.newsletters, subscribers: state.subscribers };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = `bidbuy_backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                showToast('ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œ');
            });

            // ì´ˆê¸°í™”
            document.getElementById('resetBtn')?.addEventListener('click', () => {
                if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    localStorage.clear();
                    location.reload();
                }
            });
        }

        async function handleFileUpload(file) {
            try {
                showToast('íŒŒì¼ ë¶„ì„ ì¤‘...');
                const data = await parseExcel(file);
                state.salesData = data;
                saveState();
                render();
                showToast(`${data.length}ê±´ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤`);
            } catch (err) {
                showToast('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜: ' + err.message);
            }
        }

        function buildPrompt(type) {
            const top5 = state.trendData.slice(0, 5);
            const dataContext = `
[ë°ì´í„°] ${state.weekInfo.month}ì›” ${state.weekInfo.week}ì£¼ì°¨
TOP 5 í‚¤ì›Œë“œ:
${top5.map((t, i) => `${i+1}. ${t.keyword} (${t.category}) - ${t.searches}ê±´, ${t.change >= 0 ? '+' : ''}${t.change}%`).join('\n')}
`;

            const prompts = {
                newsletter: `ë¹„ë“œë°”ì´ì½”ë¦¬ì•„ ë§ˆì¼€íŒ… ë‹´ë‹¹ìë¡œì„œ ì•„ë˜ ë°ì´í„° ê¸°ë°˜ ë‰´ìŠ¤ë ˆí„° ë³¸ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.\n${dataContext}\ní†¤: ì¹œê·¼í•˜ê³  ì „ë¬¸ì , 300~400ì, ì´ëª¨ì§€ ì ì ˆíˆ í™œìš©`,
                blog: `ì¼ë³¸ êµ¬ë§¤ëŒ€í–‰ ì „ë¬¸ ë¸”ë¡œê±°ë¡œì„œ SEO ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.\n${dataContext}\nì œëª© í¬í•¨, 600~800ì`,
                sns: `ë¹„ë“œë°”ì´ì½”ë¦¬ì•„ SNS ë‹´ë‹¹ìë¡œì„œ ì¸ìŠ¤íƒ€ê·¸ë¨ìš© í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.\n${dataContext}\n150ì ë‚´ì™¸, í•´ì‹œíƒœê·¸ 5~7ê°œ`
            };
            return prompts[type] || prompts.newsletter;
        }

        // ì´ˆê¸° ë Œë”ë§
        render();
    </script>
</body>
</html>
